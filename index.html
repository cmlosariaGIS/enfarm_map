const finishButton = document.getElementById("finishDrawingButton");
const enfarm_sensor_coordinates = []; // Declare the variable outside the event listener

finishButton.addEventListener("click", function () {
  const source = vectorLayer.getSource();
  const features = source.getFeatures();

  // Clear the array before adding new coordinate values
  enfarm_sensor_coordinates.length = 0;

  // Iterate through each feature to get the coordinates
  features.forEach(function (feature) {
    const geometry = feature.getGeometry();
    const coordinate = geometry.getCoordinates();

    // Transform the coordinates to EPSG:4326
    const transformedCoordinate = ol.proj.transform(coordinate, 'EPSG:3857', 'EPSG:4326');
    const enfarm_sensor_lat = transformedCoordinate[1];
    const enfarm_sensor_lon = transformedCoordinate[0];

    // Push the coordinates to the array
    enfarm_sensor_coordinates.push({ enfarm_sensor_lat, enfarm_sensor_lon });
  });

  // Log the coordinates to the console along with the variable name
  console.log("enfarm_sensor_coordinates:", enfarm_sensor_coordinates);

  // Disable draw interaction and revert button styles
  disableDrawInteraction();
});

// Function to disable draw interaction and revert button styles
function disableDrawInteraction() {
  // Deactivate the draw interaction
  map.removeInteraction(drawInteraction);

  // Reset the button styles
  addSensorBtnIcon.textContent = "sensors";
  addSensorBtn.style.backgroundColor = "";
  addSensorBtnIcon.style.color = "";

  // Remove the floating message if it exists
  const floatingMessage = document.getElementById("floatingMessageArea");
  if (floatingMessage && floatingMessage.parentNode === map.getViewport()) {
    map.getViewport().removeChild(floatingMessage);
  }

  // Set drawInteractionActive to false
  drawInteractionActive = false;

  // Hide the "Finish Sketch" button
  finishButton.classList.add("hidden");

  // Post a message to the React Native app
  const message = { enfarm_sensor_coordinates };
  window.ReactNativeWebView.postMessage(JSON.stringify(message));
}
