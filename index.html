<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <!--<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">-->
    <title>enfarm Map</title>
    <!--<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/ol@v7.2.2/ol.css" />-->
    <!--<script src="https://cdn.jsdelivr.net/npm/ol@v7.2.2/dist/ol.js"></script>-->

    <script src="https://cdn.jsdelivr.net/npm/ol@v7.4.0/dist/ol.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/ol@v7.4.0/ol.css">

    <script src="https://cdn.jsdelivr.net/npm/shepherd.js@10.0.1/dist/js/shepherd.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/shepherd.js@10.0.1/dist/css/shepherd.css" />


    <script src="https://cdn.jsdelivr.net/npm/driver.js@1.0.1/dist/driver.js.iife.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/driver.js@1.0.1/dist/driver.css" />



    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css2?family=Be+Vietnam+Pro&display=swap" rel="stylesheet">


    <style>
        @font-face {
            font-family: 'Be Vietnam Pro', sans-serif;
            /*src: url('fonts/BeVietnamPro-Regular.ttf') format('truetype');*/
            font-weight: normal;
            font-style: normal;
        }

        @font-face {
            font-family: 'Be Vietnam Pro', sans-serif;
            /*src: url('fonts/BeVietnamPro-Regular.ttf') format('truetype');*/
            font-weight: bold;
            font-style: normal;
        }

        body {
            font-family: 'Be Vietnam Pro', sans-serif;
            /*src: url('fonts/BeVietnamPro-Regular.ttf') format('truetype');*/
        }

        * .map {
            position: relative;
            width: 100%;
            height: 100vh;
            overflow: hidden;
            touch-action: pan-y;
            touch-action: pan-x;
        }




        .logo {
            position: absolute;
            top: 45px;
            left: 30px;
            width: 320px;
            height: 130px;
            z-index: 1;
        }

        .basemapBtn,
        .locationBtn,
        .searchBtn,
        .measureAreaBtn,
        .measureLengthBtn,
        .drawFarmBtn,
        .sketchFarmBtn,
        .northArrow,
        .resetBtn,
        .addSensorBtn,
        .tutorialBtn {
            position: fixed;
            background-color: #ffffff;
            border-radius: 50%;
            width: 120px;
            height: 120px;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            border: none;
            outline: none;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }

        .basemapBtn i,
        .locationBtn i,
        .searchBtn i,
        .measureAreaBtn i,
        .measureLengthBtn i,
        .drawFarmBtn i,
        .sketchFarmBtn i,
        .northArrow i,
        .resetBtn i,
        .addSensorBtn i,
        .tutorialBtn i {
            font-family: "Material Icons";
            font-size: 65px;
            color: #515151;
        }


        /***** START AUTO-DETECT USER LOCATION *****/
        .user-marker {
            width: 20px;
            height: 20px;
            background-color: #007bff;
            border-radius: 50%;
            animation: glowing 1s infinite;
        }

        @keyframes glowing {
            0% {
                box-shadow: 0 0 0 0 rgba(0, 123, 255, 0.7);
            }

            50% {
                box-shadow: 0 0 0 10px rgba(0, 123, 255, 0.7);
            }

            100% {
                box-shadow: 0 0 0 0 rgba(0, 123, 255, 0.7);
            }
        }

        /***** END AUTO-DETECT USER LOCATION *****/


        /***** START SEARCH BUTTON FUNCTION *****/
        .searchBtn {
            position: absolute;
            top: 60px;
            right: 30px;
            z-index: 1;
            display: flex;
            justify-content: center;
            align-items: center;
        }


        .searchBar {
            display: none;
            position: absolute;
            height: 120px;
            top: 60px;
            right: 30px;
            display: flex;
            align-items: center;
            background-color: #ffffff;
            border-radius: 100px;
            padding: 2px 10px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
            width: 890px;
            z-index: 10;
        }

        .searchInput {
            flex: 1;
            border: none;
            outline: none;
            font-size: 40px;
            color: #515151;
            padding: 20px;
            padding-left: 40px;
            font-family: 'Be Vietnam Pro', Arial, sans-serif;
            display: flex;
            align-items: center;
            border-radius: 100px;
        }


        .searchButton {
            background-color: #ffffff00;
            border-radius: 0%;
            width: 45px;
            height: 45px;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            border: none;
            outline: none;
            padding-right: 36px
        }

        .searchButton i {
            color: #686868;
            font-size: 80px;
            padding-right: 20px;

        }

        .suggestionsContainer {
            position: absolute;
            top: 140px;
            left: 0;
            width: 890px;
            max-height: 600px;
            overflow-y: auto;
            background-color: #ffffff;
            border-radius: 20px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
            padding: 10px;
            z-index: 5;
            display: none;

        }

        .suggestionsContainer::-webkit-scrollbar {
            width: 10px;
        }

        .suggestionsContainer::-webkit-scrollbar-track {
            border-radius: 10px;
            background-color: #f1f1f1;
        }

        .suggestionsContainer::-webkit-scrollbar-thumb {
            border-radius: 10px;
            background-color: #888;
        }

        .suggestionsContainer::-webkit-scrollbar-thumb:hover {
            background-color: #555;
        }


        .suggestionsContainer div {
            padding: 5px;
            cursor: pointer;
        }

        .suggestionsContainer div:hover {
            background-color: #f2f2f2;
        }

        .suggestionItem {
            display: flex;
            align-items: center;
            padding: 10px;
            padding-left: 100px;
            color: #515151;
        }

        .suggestionText {
            font-size: 40px;
            /* Adjust the font size as needed */
        }

        /* Add a new class to style the historical search places */
        .historicalPlace {
            font-style: italic;
            color: #888888;
        }

        .gpsIcon {
            margin-right: 30px;
            margin-left: 20px;
            color: #a8a8a8;
            font-size: 60px;
        }

        /*spinning icon on search bar*/
        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        .sync-spin {
            animation: spin 5s infinite linear;
        }


        /*Search results POI label*/
        .marker-label {
            background-color: rgba(255, 255, 255, 0.8);
            color: #000;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
        }


        .suggestionItem .deleteButton {
            width: 80px;
            height: 80px;
            border: none;
            background-color: transparent;
            color: #777;
            font-size: 40px;
            cursor: pointer;
            transition: color 0.3s ease-in-out;
            margin-left: auto;
        }

        .deleteButton:hover {
            color: #ff4d4d;
        }

        #clearAllBtn {
            font-size: 40px;
            background-color: #ffffff;
            color: #515151;
            border: none;
            border-radius: 5px;
            padding: 10px 20px;
            margin-top: 10px;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }


        /***** END SEARCH BUTTON FUNCTION *****/


        /***** START SWITCH BASEMAP BUTTON FUNCTION *****/
        .basemapBtn {
            position: absolute;
            top: 10px;
            right: 30px;
            z-index: 1;
        }

        .basemapswitcher {
            position: absolute;
            top: 185px;
            right: 0px;
            z-index: 1;
        }

        .basemapSelector {
            position: absolute;
            left: 50%;
            height: 100%;
            top: 0;
            bottom: 0;
            transform: translateX(-50%) translateY(100%);
            width: 100%;
            max-height: calc(100% - 20px);
            border-radius: 20px 20px 0 0;
            background-color: rgba(255, 255, 255);
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
            z-index: 10;
            overflow: auto;
            transition: transform 0.3s;
        }

        .container-content {
            padding: 20px;
            text-align: center;
            font-size: 25px;
            color: #515151;
        }

        .container-content .image-container {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            grid-template-rows: repeat(2, 1fr);
            gap: 40px;
            margin-top: 80px;
        }

        .container-content .image-container img {
            width: 100%;
            height: auto;
            object-fit: cover;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
            border-radius: 50px;
        }

        .container-content .image-container .caption {
            font-size: 30px;
            font-weight: bold;
            margin-top: 5px;
            color: #515151;
        }

        .image-container>div {
            position: relative;
        }

        .image-container>div.selected .selected-basemap-circle {
            display: block;
        }

        .selected-basemap-circle {
            position: absolute;
            bottom: 75px;
            right: 25px;
            width: 30px;
            height: 30px;
            background-color: green;
            border-radius: 50%;
            border: 6px solid white;
            display: none;
            animation: glow 1s ease-in-out infinite alternate;
        }

        @keyframes glow {
            0% {
                box-shadow: 0 0 5px green;
            }

            100% {
                box-shadow: 0 0 20px green;
            }
        }

        .close-bm-button {
            position: absolute;
            top: 42px;
            right: 30px;
            cursor: pointer;
            color: #515151;
        }

        .close-bm-button i {
            font-size: 60px;
        }




        /***** END SWITCH BASEMAP BUTTON FUNCTION *****/

        /***** START MEASURE AREA AND LINE BUTTON FUNCTION *****/

        .measureAreaBtn {
            position: absolute;
            top: 335px;
            right: 30px;
            z-index: 1;
        }

        .measureLengthBtn {
            position: absolute;
            top: 480px;
            right: 30px;
            z-index: 1;
        }

        .floating-message {
            position: absolute;
            top: 60px;
            left: 50%;
            transform: translateX(-50%);
            background-color: #ffffff;
            color: #515151;
            padding: 20px;
            border-radius: 100px;
            font-size: 40px;
            text-align: center;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 600px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
            z-index: 3;
        }

        /*Tap to draw floating message*/
        .floating-message i {
            font-size: 60px;
            animation-name: cycling-animation;
            animation-duration: 1s;
            animation-iteration-count: infinite;
            animation-timing-function: ease-in-out;
        }

        @keyframes cycling-animation {
            0% {
                transform: scale(1);
            }

            50% {
                transform: scale(0.8);
            }

            100% {
                transform: scale(1);
            }
        }

        /***** END MEASURE AREA AND LINE BUTTON FUNCTION *****/

        /***** START SKETCH FARM BUTTON FUNCTION *****/

        .sketchFarmBtn {
            position: absolute;
            top: 620px;
            right: 30px;
            z-index: 1;
        }

        .addSensorBtn {
            position: absolute;
            top: 760px;
            right: 30px;
            z-index: 1;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        /*Draw Farm Area Size*/
        /*Finish Sketch/Drawing Button*/
        .sketch-buttons {
            position: relative;
            bottom: 25%;
            left: 50%;
            transform: translate(-50%, 50%);
            display: flex;
            justify-content: center;
            width: 900px;
            flex-wrap: nowrap;
            gap: 50px;
        }

        .finish-drawing {
            background-color: #ffffff;
            padding: 35px 50px;
            border-radius: 10px;
            font-size: 40px;
            color: #515151;
            outline: none;
            border: none;
            border-radius: 100px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
            transition: background-color 0.3s ease;
            display: flex;
            align-items: center;
            gap: 10px;
        }


        .finish-drawing:hover {
            cursor: pointer;
            background-color: #f1f1f1;
        }


        /*finish drawing check icon*/
        .check-icon {
            margin-right: 10px;
            font-family: 'Material Icons', sans-serif;
        }

        /***** END DRAW FARM BUTTON FUNCTION *****/


        * END USER LOCATION BUTTON *****/

        /***** START NORTH ARROW BUTTON FUNCTION *****/
        .northArrow {
            position: absolute;
            top: 50%;
            left: 34px;
            transform: translate(-50%, -50%);
            background-color: #fff;
            border-radius: 50%;
            width: 120px;
            height: 120px;
            z-index: 1;
            box-sizing: border-box;
        }

        .northArrow .material-icons {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 65px;
        }

        .northArrow i {
            transform: rotate(0deg);
            transition: transform 0.3s ease-in-out;
        }

        /***** END NORTH ARROW BUTTON FUNCTION *****/

        /***** START MOBILE RESPONSIVENESS *****/

        /* Media query for smaller screens */
        @media (max-width: 768px) {

            /* Adjust map container height for smaller screens */
            .map {
                height: 300px;
            }

            /* Adjust button styles for smaller screens */
            .basemapBtn,
            .locationBtn,
            .searchBtn,
            .measureAreaBtn,
            .measureLengthBtn,
            .drawFarmBtn,
            .sketchFarmBtn,
            .northArrow,
            .resetBtn,
            .addSensorBtn .tutorialBtn {
                font-size: 20px;
                padding: 8px 12px;
            }
        }

        /* Media query for even smaller screens */
        @media (max-width: 480px) {

            /* Adjust map container height for even smaller screens */
            .map {
                height: 200px;
            }

            /* Adjust button styles for even smaller screens */
            .basemapBtn,
            .locationBtn,
            .searchBtn,
            .measureAreaBtn,
            .measureLengthBtn,
            .drawFarmBtn,
            .sketchFarmBtn,
            .northArrow,
            .resetBtn,
            .addSensorBtn .tutorialBtn {
                font-size: 16px;
                padding: 6px 10px;
            }
        }

        /***** END MOBILE RESPONSIVENESS *****/


        /*
        .hidden {
            display: none;
        }
        */

        .dialog {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 5;
        }

        .dialog-content {
            background-color: white;
            padding: 80px;
            border-radius: 20px;
            text-align: center;
            box-shadow: 0px 0px 15px rgba(0, 0, 0, 0.1);
            /* Subtle box-shadow for depth */
            width: 600px;
            height: 300px;
            font-size: 40px;
            color: #515151;
            max-width: 100%;
            box-shadow: #515151;
        }

        /* Yes and Cancel Button*/
        .dialog-button {
            font-size: 40px;
            margin: 10px;
            padding: 20px 70px;
            border-radius: 20px;
            border: none;
            color: white;
            cursor: pointer;
            /*background: linear-gradient(to bottom, #f2709c, #ff9472);*/
            box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.1);

        }

        .hidden {
            display: none;
        }

        #tutorialBtn {

            position: fixed;
            bottom: 70%;
            left: 70px;
            background-color: #ffffff;
            border: none;
            border-radius: 50%;
            width: 60px;
            height: 60px;
            display: flex;
            justify-content: center;
            align-items: center;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
            cursor: pointer;

        }

        #tutorialBtn i.material-icons {
            font-size: 40px;
            color: #515151;
        }

        #clearAllDrawingBtn {

            position: fixed;
            bottom: 60%;
            left: 70px;
            background-color: #ff0000;
            border: none;
            border-radius: 50%;
            width: 60px;
            height: 60px;
            display: flex;
            justify-content: center;
            align-items: center;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
            cursor: pointer;

        }

        #clearAllDrawingBtn i.material-icons {
            font-size: 40px;
            color: #ffffff;
        }

        /***** START USER LOCATION BUTTON *****/
        .locationBtn {
            position: absolute;
            bottom:30%;
            left: 30px;
            z-index: 1;
        }

        /****

        /****** Start Reset Button *******/
        #resetBtn {
            position: fixed;
            bottom: 15%;
            left: 40px;
            background-color: #ffffff;
            border: none;
            border-radius: 50%;
            width: 120px;
            height: 120px;
            display: flex;
            justify-content: center;
            align-items: center;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
            cursor: pointer;

        }

        #resetBtn i.material-icons {
            font-size: 65px;
            color: #515151;
        }

        /****** End Reset Button *******/


        /****** Start Scale line Styles *******/
        .ol-scale-line {
            position: fixed;
            bottom: 5%;
            left: 30px;
            background: none;
            border: none;
            box-shadow: none;
            color: #515151;
            line-height: 1;
            margin: 0;
            padding: 0;
        }

        .ol-scale-line-inner {
            position: relative;
            background: #fff;
            border-radius: 3px;
            box-shadow: 0px 2px 5px rgba(0, 0, 0, 0.3);
            color: #515151;
            padding: 3px 6px;
            font-size: 30px;
            font-family: Be Vietnam Pro', Arial, sans-serif;

        }

        .ol-scale-line-inner::before,
        .ol-scale-line-inner::after {
            content: "";
            position: absolute;
            bottom: 0;
            width: 1px;
            height: 50%;
            background-color: #fff;
        }

        .ol-scale-line-inner::before {
            left: 25%;
        }

        .ol-scale-line-inner::after {
            right: 25%;
        }

        /****** End Scale line Styles *******/

        /***** Start Product Tour *****/
        /*Next Button*/
        .shepherd-button {
            background: green;
            font-family: 'Be Vietnam Pro', Arial, sans-serif;
            border: 0;
            border-radius: 10px;
            color: white;
            cursor: pointer;
            margin-right: .5rem;
            padding: 1rem 2.5rem;
            transition: all .5s ease
        }

        .shepherd-button:not(:disabled):hover {
            background: green;
            color: hsla(0, 0%, 100%, .75)
        }

        /*Modal*/
        .shepherd-element {
            background: #fff;
            border-radius: 10px;
            box-shadow: 0 1px 4px rgba(0, 0, 0, .2);
            max-width: 800px;
            max-height: 300px;
            opacity: 0;
            outline: none;
            padding-left: 10px;
            padding-top: 20px;
            transition: opacity .3s, visibility .3s;
            visibility: hidden;
            width: 100%;
            z-index: 9999
        }

        .shepherd-button.shepherd-button-secondary {
            background: #3288e6;
            color: white;
            font-family: 'Be Vietnam Pro', Arial, sans-serif;

        }

        .shepherd-button.shepherd-button-secondary:not(:disabled):hover {
            background: #196fcc;
            color: hsla(0, 0%, 100%, .75);
        }

        .shepherd-button:disabled {
            cursor: not-allowed
        }

        .shepherd-button {
            font-family: 'Be Vietnam Pro', Arial, sans-serif;
        }

        .shepherd-text p {
            margin-bottom: 20px;
        }

        .shepherd-has-title .shepherd-content .shepherd-header {
            background: #e6e6e6;
            padding: 1em
        }

        .shepherd-text {
            color: rgba(0, 0, 0, .75);
            font-size: 1rem;
            line-height: 2.5em;
            padding: .75em
        }

        .shepherd-text p:last-child {
            margin-bottom: 0
        }

        .shepherd-content {
            border-radius: 5px;
            outline: none;
            padding: 0
        }

        /***** End Map Product Tour *****/

        .isric-attribution,
        .osm-attribution,
        .mapbox-attribution {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 9999;
            background-color: white;
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
            display: none;
            width: 800px;
        }

        .isric-attribution p,
        .osm-attribution p,
        .mapbox-attribution p {
            margin: 0;
            line-height: 1.5;
            font-size: 40px;
        }

        .isric-attribution .hidden-link,
        .osm-attribution a,
        .mapbox-attribution a {
            color: blue;
            text-decoration: underline;
        }

        .isric-attribution .close-button,
        .osm-attribution .close-button,
        .mapbox-attribution .close-button {
            position: absolute;
            top: 10px;
            right: 10px;
            padding-bottom: 40px;
            padding-right: 10px;
            padding-top: 10px;
            font-size: 60px;
            color: #515151;
            cursor: pointer;
        }

        .info-icon:hover,
        .osminfo-icon:hover,
        .mapboxinfo-icon:hover {
            cursor: pointer;
        }


        /* Basemap Legend */
        /* Legend Containers */
        .carbonLegend,
        .nitrogenLegend,
        .phLegend {
            width: 135px;
            height: 820px;
            background-color: #ffffff;
            position: absolute;
            top: 60px;
            z-index: 9999;
            border-radius: 10px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
            display: flex;
            flex-direction: column;
            justify-content: flex-start;
            align-items: flex-start;
            color: #515151;
            font-family: 'Be Vietnam Pro', Arial, sans-serif;
            overflow-y: auto;
            overflow-x: hidden;
            padding-bottom: 35px;
            display: none;
            z-index: 7;
        }

        .carbonLegend,
        .phLegend,
        .nitrogenLegend {
            right: 175px;
        }

        /* Text */
        .carbonLegend .text,
        .nitrogenLegend .text,
        .phLegend .text {
            font-size: 28px;
            margin-top: 20px;
            margin-bottom: 30px;
            margin-left: 10px;
            color: #515151;
            font-family: 'Be Vietnam Pro', Arial, sans-serif;
            text-align: center;
        }


        .closecarbonLegend,
        .closenitrogenLegend,
        .closepHLegend {
            position: absolute;
            top: 50px;
            background-color: #ffffff;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            z-index: 8;
            right: 165px;
            display: none;
        }

        .closecarbonLegend i,
        .closenitrogenLegend i,
        .closepHLegend i {
            font-size: 45px;
            color: #ff4d4d;
            display: none;
            position: relative;
            top: -10px;
            right: 11px;
            z-index: 9;
        }


        /* Scrollbar */
        .carbonLegend::-webkit-scrollbar,
        .nitrogenLegend::-webkit-scrollbar,
        .phLegend::-webkit-scrollbar {
            display: none;
        }

        .carbonLegend::-webkit-scrollbar-thumb,
        .nitrogenLegend::-webkit-scrollbar-thumb,
        .phLegend::-webkit-scrollbar-thumb {
            background-color: transparent;
        }

        .carbonLegend::-webkit-scrollbar-track,
        .nitrogenLegend::-webkit-scrollbar-track,
        .phLegend::-webkit-scrollbar-track {
            background-color: #f1f1f1;
        }

        /* Color Value Container */
        .colorValueContainer {
            display: flex;
            align-items: center;
            margin-top: 10px;
            margin-left: 20px;
            margin-top: 3px;
        }

        /* Color Box */
        .colorBox {
            width: 40px;
            height: 30px;
            margin-right: 5px;
            border-radius: 5px;
        }
    </style>
</head>

<body>

    <div class="map">

        <div id="map" class="map">
            <div class="blur-mask"></div>
        </div>

        <div>
            <img src="https://i.ibb.co/LCK5s6V/en-Farm-logo-6-2x.png" alt="Logo" class="logo">
        </div>

        <div class="carbonlegend" id="carbonlegend">
            <div class="carbonLegend" id="carbonLegend">
                <div class="text">kg/m2</div>
                <div class="colorValueContainer">
                    <div class="colorBox" style="background-color: #ffffca;"></div>
                    <div class="values">
                        <div class="value" style="font-size: 24px;">0</div>
                    </div>
                </div>
                <div class="colorValueContainer">
                    <div class="colorBox" style="background-color: #ffffbe;"></div>
                    <div class="values">
                        <div class="value" style="font-size: 24px;">5</div>
                    </div>
                </div>
                <div class="colorValueContainer">
                    <div class="colorBox" style="background-color: #ffffbd;"></div>
                    <div class="values">
                        <div class="value" style="font-size: 24px;">11</div>
                    </div>
                </div>
                <div class="colorValueContainer">
                    <div class="colorBox" style="background-color: #ffefa7;"></div>
                    <div class="values">
                        <div class="value" style="font-size: 24px;">18</div>
                    </div>
                </div>
                <div class="colorValueContainer">
                    <div class="colorBox" style="background-color: #ffefa7;"></div>
                    <div class="values">
                        <div class="value" style="font-size: 24px;">25</div>
                    </div>
                </div>
                <div class="colorValueContainer">
                    <div class="colorBox" style="background-color: #ffe091;"></div>
                    <div class="values">
                        <div class="value" style="font-size: 24px;">31</div>
                    </div>
                </div>
                <div class="colorValueContainer">
                    <div class="colorBox" style="background-color: #fad27c;"></div>
                    <div class="values">
                        <div class="value" style="font-size: 24px;">38</div>
                    </div>
                </div>
                <div class="colorValueContainer">
                    <div class="colorBox" style="background-color: #fad27c;"></div>
                    <div class="values">
                        <div class="value" style="font-size: 24px;">45</div>
                    </div>
                </div>
                <div class="colorValueContainer">
                    <div class="colorBox" style="background-color: #dbcc6d;"></div>
                    <div class="values">
                        <div class="value" style="font-size: 24px;">51</div>
                    </div>
                </div>
                <div class="colorValueContainer">
                    <div class="colorBox" style="background-color: #b8bc5d;"></div>
                    <div class="values">
                        <div class="value" style="font-size: 24px;">58</div>
                    </div>
                </div>
                <div class="colorValueContainer">
                    <div class="colorBox" style="background-color: #b8bc5d;"></div>
                    <div class="values">
                        <div class="value" style="font-size: 24px;">65</div>
                    </div>
                </div>
                <div class="colorValueContainer">
                    <div class="colorBox" style="background-color: #8b9d4e;"></div>
                    <div class="values">
                        <div class="value" style="font-size: 24px;">71</div>
                    </div>
                </div>
                <div class="colorValueContainer">
                    <div class="colorBox" style="background-color: #688941;"></div>
                    <div class="values">
                        <div class="value" style="font-size: 24px;">78</div>
                    </div>
                </div>
                <div class="colorValueContainer">
                    <div class="colorBox" style="background-color: #688941;"></div>
                    <div class="values">
                        <div class="value" style="font-size: 24px;">85</div>
                    </div>
                </div>
                <div class="colorValueContainer">
                    <div class="colorBox" style="background-color: #498939;"></div>
                    <div class="values">
                        <div class="value" style="font-size: 24px;">91</div>
                    </div>
                </div>
                <div class="colorValueContainer">
                    <div class="colorBox" style="background-color: #32893f;"></div>
                    <div class="values">
                        <div class="value" style="font-size: 24px;">98</div>
                    </div>
                </div>
                <div class="colorValueContainer">
                    <div class="colorBox" style="background-color: #32893f;"></div>
                    <div class="values">
                        <div class="value" style="font-size: 24px;">105</div>
                    </div>
                </div>
                <div class="colorValueContainer">
                    <div class="colorBox" style="background-color: #2a895a;"></div>
                    <div class="values">
                        <div class="value" style="font-size: 24px;">111</div>
                    </div>
                </div>
                <div class="colorValueContainer">
                    <div class="colorBox" style="background-color: #2a895a;"></div>
                    <div class="values">
                        <div class="value" style="font-size: 24px;">118</div>
                    </div>
                </div>
                <div class="colorValueContainer">
                    <div class="colorBox" style="background-color: #1f8671;"></div>
                    <div class="values">
                        <div class="value" style="font-size: 24px;">125</div>
                    </div>
                </div>
                <div class="colorValueContainer">
                    <div class="colorBox" style="background-color: #16817c;"></div>
                    <div class="values">
                        <div class="value" style="font-size: 24px;">131</div>
                    </div>
                </div>
                <div class="colorValueContainer">
                    <div class="colorBox" style="background-color: #16817c;"></div>
                    <div class="values">
                        <div class="value" style="font-size: 24px;">138</div>
                    </div>
                </div>
                <div class="colorValueContainer">
                    <div class="colorBox" style="background-color: #0c6e7b;"></div>
                    <div class="values">
                        <div class="value" style="font-size: 24px;">145</div>
                    </div>
                </div>
                <div class="colorValueContainer">
                    <div class="colorBox" style="background-color: #035675;"></div>
                    <div class="values">
                        <div class="value" style="font-size: 24px;">151</div>
                    </div>
                </div>
                <div class="colorValueContainer">
                    <div class="colorBox" style="background-color: #035675;"></div>
                    <div class="values">
                        <div class="value" style="font-size: 24px;">158</div>
                    </div>
                </div>
                <div class="colorValueContainer">
                    <div class="colorBox" style="background-color: #094273;"></div>
                    <div class="values">
                        <div class="value" style="font-size: 24px;">165</div>
                    </div>
                </div>
                <div class="colorValueContainer">
                    <div class="colorBox" style="background-color: #1a3273;"></div>
                    <div class="values">
                        <div class="value" style="font-size: 24px;">171</div>
                    </div>
                </div>
                <div class="colorValueContainer">
                    <div class="colorBox" style="background-color: #1a3273;"></div>
                    <div class="values">
                        <div class="value" style="font-size: 24px;">178</div>
                    </div>
                </div>
                <div class="colorValueContainer">
                    <div class="colorBox" style="background-color: #2a2173;"></div>
                    <div class="values">
                        <div class="value" style="font-size: 24px;">185</div>
                    </div>
                </div>
                <div class="colorValueContainer">
                    <div class="colorBox" style="background-color: #3b1073;"></div>
                    <div class="values">
                        <div class="value" style="font-size: 24px;">191</div>
                    </div>
                </div>
                <div class="colorValueContainer">
                    <div class="colorBox" style="background-color: #3b1073;"></div>
                    <div class="values">
                        <div class="value" style="font-size: 24px;">198</div>
                    </div>
                </div>
                <div class="colorValueContainer">
                    <div class="colorBox" style="background-color: #4c0073;"></div>
                    <div class="values">
                        <div class="value" style="font-size: 24px;">205</div>
                    </div>
                </div>
                <div class="colorValueContainer">
                    <div class="colorBox" style="background-color: #4c0073;"></div>
                    <div class="values">
                        <div class="value" style="font-size: 24px;">212</div>
                    </div>
                </div>

            </div>
            <div class="closecarbonLegend">
                <i class="material-icons">cancel</i>
            </div>
        </div>

        <div class="pHlegend" id="pHlegend">
            <div class="phLegend">
                <div class="text">pH</div>
                <div class="colorValueContainer">
                    <div class="colorBox" style="background-color: #F0F63C;"></div>
                    <div class="values">
                        <div class="value" style="font-size: 24px;">0</div>
                    </div>
                </div>
                <div class="colorValueContainer">
                    <div class="colorBox" style="background-color: #F0F63D;"></div>
                    <div class="values">
                        <div class="value" style="font-size: 24px;">34</div>
                    </div>
                </div>
                <div class="colorValueContainer">
                    <div class="colorBox" style="background-color: #F1EE2D;"></div>
                    <div class="values">
                        <div class="value" style="font-size: 24px;">48</div>
                    </div>
                </div>
                <div class="colorValueContainer">
                    <div class="colorBox" style="background-color: #F1E51C;"></div>
                    <div class="values">
                        <div class="value" style="font-size: 24px;">51</div>
                    </div>
                </div>
                <div class="colorValueContainer">
                    <div class="colorBox" style="background-color: #EBE51A;"></div>
                    <div class="values">
                        <div class="value" style="font-size: 24px;">52</div>
                    </div>
                </div>
                <div class="colorValueContainer">
                    <div class="colorBox" style="background-color: #E0E41A;"></div>
                    <div class="values">
                        <div class="value" style="font-size: 24px;">54</div>
                    </div>
                </div>
                <div class="colorValueContainer">
                    <div class="colorBox" style="background-color: #C0DF28;"></div>
                    <div class="values">
                        <div class="value" style="font-size: 24px;">55</div>
                    </div>
                </div>
                <div class="colorValueContainer">
                    <div class="colorBox" style="background-color: #A5DB36;"></div>
                    <div class="values">
                        <div class="value" style="font-size: 24px;">56</div>
                    </div>
                </div>
                <div class="colorValueContainer">
                    <div class="colorBox" style="background-color: #8DD645;"></div>
                    <div class="values">
                        <div class="value" style="font-size: 24px;">57</div>
                    </div>
                </div>
                <div class="colorValueContainer">
                    <div class="colorBox" style="background-color: #86D44E;"></div>
                    <div class="values">
                        <div class="value" style="font-size: 24px;">58</div>
                    </div>
                </div>
                <div class="colorValueContainer">
                    <div class="colorBox" style="background-color: #80D253;"></div>
                    <div class="values">
                        <div class="value" style="font-size: 24px;">59</div>
                    </div>
                </div>
                <div class="colorValueContainer">
                    <div class="colorBox" style="background-color: #72C94C;"></div>
                    <div class="values">
                        <div class="value" style="font-size: 24px;">60</div>
                    </div>
                </div>
                <div class="colorValueContainer">
                    <div class="colorBox" style="background-color: #61C041;"></div>
                    <div class="values">
                        <div class="value" style="font-size: 24px;">61</div>
                    </div>
                </div>
                <div class="colorValueContainer">
                    <div class="colorBox" style="background-color: #51B836;"></div>
                    <div class="values">
                        <div class="value" style="font-size: 24px;">62</div>
                    </div>
                </div>
                <div class="colorValueContainer">
                    <div class="colorBox" style="background-color: #4BB736;"></div>
                    <div class="values">
                        <div class="value" style="font-size: 24px;">64</div>
                    </div>
                </div>
                <div class="colorValueContainer">
                    <div class="colorBox" style="background-color: #42B532;"></div>
                    <div class="values">
                        <div class="value" style="font-size: 24px;">65</div>
                    </div>
                </div>
                <div class="colorValueContainer">
                    <div class="colorBox" style="background-color: #42B532;"></div>
                    <div class="values">
                        <div class="value" style="font-size: 24px;">67</div>
                    </div>
                </div>
                <div class="colorValueContainer">
                    <div class="colorBox" style="background-color: #36ad31;"></div>
                    <div class="values">
                        <div class="value" style="font-size: 24px;">68</div>
                    </div>
                </div>
                <div class="colorValueContainer">
                    <div class="colorBox" style="background-color: #35A536;"></div>
                    <div class="values">
                        <div class="value" style="font-size: 24px;">70</div>
                    </div>
                </div>
                <div class="colorValueContainer">
                    <div class="colorBox" style="background-color: #4CA851;"></div>
                    <div class="values">
                        <div class="value" style="font-size: 24px;">72</div>
                    </div>
                </div>
                <div class="colorValueContainer">
                    <div class="colorBox" style="background-color: #329A3D;"></div>
                    <div class="values">
                        <div class="value" style="font-size: 24px;">73</div>
                    </div>
                </div>
                <div class="colorValueContainer">
                    <div class="colorBox" style="background-color: #2F993F;"></div>
                    <div class="values">
                        <div class="value" style="font-size: 24px;">75</div>
                    </div>
                </div>
                <div class="colorValueContainer">
                    <div class="colorBox" style="background-color: #2C9840;"></div>
                    <div class="values">
                        <div class="value" style="font-size: 24px;">76</div>
                    </div>
                </div>
                <div class="colorValueContainer">
                    <div class="colorBox" style="background-color: #2a9945;"></div>
                    <div class="values">
                        <div class="value" style="font-size: 24px;">77</div>
                    </div>
                </div>
                <div class="colorValueContainer">
                    <div class="colorBox" style="background-color: #4CB075;"></div>
                    <div class="values">
                        <div class="value" style="font-size: 24px;">79</div>
                    </div>
                </div>
                <div class="colorValueContainer">
                    <div class="colorBox" style="background-color: #35B993;"></div>
                    <div class="values">
                        <div class="value" style="font-size: 24px;">80</div>
                    </div>
                </div>
                <div class="colorValueContainer">
                    <div class="colorBox" style="background-color: #2CB5A2;"></div>
                    <div class="values">
                        <div class="value" style="font-size: 24px;">81</div>
                    </div>
                </div>
                <div class="colorValueContainer">
                    <div class="colorBox" style="background-color: #28B6B5;"></div>
                    <div class="values">
                        <div class="value" style="font-size: 24px;">82</div>
                    </div>
                </div>
                <div class="colorValueContainer">
                    <div class="colorBox" style="background-color: #1BC1C7;"></div>
                    <div class="values">
                        <div class="value" style="font-size: 24px;">83</div>
                    </div>
                </div>
                <div class="colorValueContainer">
                    <div class="colorBox" style="background-color: #0FCCD9;"></div>
                    <div class="values">
                        <div class="value" style="font-size: 24px;">92</div>
                    </div>
                </div>
            </div>
            <div class="closepHLegend">
                <i class="material-icons">cancel</i>
            </div>
        </div>

        <div class="nitrogenlegend" id="nitrogenlegend">
            <div class="nitrogenLegend">
                <div class="text">g/kg</div>
                <div class="colorValueContainer">
                    <div class="colorBox" style="background-color: #F7FCF5;"></div>
                    <div class="values">
                        <div class="value" style="font-size: 24px;">0</div>
                    </div>
                </div>
                <div class="colorValueContainer">
                    <div class="colorBox" style="background-color: #F7FCF5;"></div>
                    <div class="values">
                        <div class="value" style="font-size: 24px;">42</div>
                    </div>
                </div>
                <div class="colorValueContainer">
                    <div class="colorBox" style="background-color: #F3FBF0;"></div>
                    <div class="values">
                        <div class="value" style="font-size: 24px;">80</div>
                    </div>
                </div>
                <div class="colorValueContainer">
                    <div class="colorBox" style="background-color: #EEF9EB;"></div>
                    <div class="values">
                        <div class="value" style="font-size: 24px;">119</div>
                    </div>
                </div>
                <div class="colorValueContainer">
                    <div class="colorBox" style="background-color: #EAF7E6;"></div>
                    <div class="values">
                        <div class="value" style="font-size: 24px;">157</div>
                    </div>
                </div>
                <div class="colorValueContainer">
                    <div class="colorBox" style="background-color: #E6F6E1;"></div>
                    <div class="values">
                        <div class="value" style="font-size: 24px;">196</div>
                    </div>
                </div>
                <div class="colorValueContainer">
                    <div class="colorBox" style="background-color: #DEF3D9;"></div>
                    <div class="values">
                        <div class="value" style="font-size: 24px;">234</div>
                    </div>
                </div>
                <div class="colorValueContainer">
                    <div class="colorBox" style="background-color: #D7F0D1;"></div>
                    <div class="values">
                        <div class="value" style="font-size: 24px;">273</div>
                    </div>
                </div>
                <div class="colorValueContainer">
                    <div class="colorBox" style="background-color: #CFEDC9;"></div>
                    <div class="values">
                        <div class="value" style="font-size: 24px;">311</div>
                    </div>
                </div>
                <div class="colorValueContainer">
                    <div class="colorBox" style="background-color: #C8EAC1;"></div>
                    <div class="values">
                        <div class="value" style="font-size: 24px;">350</div>
                    </div>
                </div>
                <div class="colorValueContainer">
                    <div class="colorBox" style="background-color: #BEE6B8;"></div>
                    <div class="values">
                        <div class="value" style="font-size: 24px;">388</div>
                    </div>
                </div>
                <div class="colorValueContainer">
                    <div class="colorBox" style="background-color: #BCE5B6;"></div>
                    <div class="values">
                        <div class="value" style="font-size: 24px;">427</div>
                    </div>
                </div>
                <div class="colorValueContainer">
                    <div class="colorBox" style="background-color: #B9E3B2;"></div>
                    <div class="values">
                        <div class="value" style="font-size: 24px;">466</div>
                    </div>
                </div>
                <div class="colorValueContainer">
                    <div class="colorBox" style="background-color: #ABDEA5;"></div>
                    <div class="values">
                        <div class="value" style="font-size: 24px;">504</div>
                    </div>
                </div>
                <div class="colorValueContainer">
                    <div class="colorBox" style="background-color: #A2DA9C;"></div>
                    <div class="values">
                        <div class="value" style="font-size: 24px;">543</div>
                    </div>
                </div>
                <div class="colorValueContainer">
                    <div class="colorBox" style="background-color: #97D593;"></div>
                    <div class="values">
                        <div class="value" style="font-size: 24px;">581</div>
                    </div>
                </div>
                <div class="colorValueContainer">
                    <div class="colorBox" style="background-color: #8CCF8A;"></div>
                    <div class="values">
                        <div class="value" style="font-size: 24px;">620</div>
                    </div>
                </div>
                <div class="colorValueContainer">
                    <div class="colorBox" style="background-color: #81CA80;"></div>
                    <div class="values">
                        <div class="value" style="font-size: 24px;">658</div>
                    </div>
                </div>
                <div class="colorValueContainer">
                    <div class="colorBox" style="background-color: #75C577;"></div>
                    <div class="values">
                        <div class="value" style="font-size: 24px;">697</div>
                    </div>
                </div>
                <div class="colorValueContainer">
                    <div class="colorBox" style="background-color: #71C277;"></div>
                    <div class="values">
                        <div class="value" style="font-size: 24px;">735</div>
                    </div>
                </div>
                <div class="colorValueContainer">
                    <div class="colorBox" style="background-color: #5CB96A;"></div>
                    <div class="values">
                        <div class="value" style="font-size: 24px;">774</div>
                    </div>
                </div>
                <div class="colorValueContainer">
                    <div class="colorBox" style="background-color: #4FB264;"></div>
                    <div class="values">
                        <div class="value" style="font-size: 24px;">812</div>
                    </div>
                </div>
                <div class="colorValueContainer">
                    <div class="colorBox" style="background-color: #3aa458;"></div>
                    <div class="values">
                        <div class="value" style="font-size: 24px;">851</div>
                    </div>
                </div>
                <div class="colorValueContainer">
                    <div class="colorBox" style="background-color: #339C52;"></div>
                    <div class="values">
                        <div class="value" style="font-size: 24px;">890</div>
                    </div>
                </div>
                <div class="colorValueContainer">
                    <div class="colorBox" style="background-color: #2A944C;"></div>
                    <div class="values">
                        <div class="value" style="font-size: 24px;">928</div>
                    </div>
                </div>
                <div class="colorValueContainer">
                    <div class="colorBox" style="background-color: #248C46;"></div>
                    <div class="values">
                        <div class="value" style="font-size: 24px;">967</div>
                    </div>
                </div>
                <div class="colorValueContainer">
                    <div class="colorBox" style="background-color: #248C47;"></div>
                    <div class="values">
                        <div class="value" style="font-size: 24px;">1005</div>
                    </div>
                </div>
                <div class="colorValueContainer">
                    <div class="colorBox" style="background-color: #19873F;"></div>
                    <div class="values">
                        <div class="value" style="font-size: 24px;">1044</div>
                    </div>
                </div>
                <div class="colorValueContainer">
                    <div class="colorBox" style="background-color: #14853C;"></div>
                    <div class="values">
                        <div class="value" style="font-size: 24px;">1082</div>
                    </div>
                </div>
                <div class="colorValueContainer">
                    <div class="colorBox" style="background-color: #0F8339;"></div>
                    <div class="values">
                        <div class="value" style="font-size: 24px;">1121</div>
                    </div>
                </div>
                <div class="colorValueContainer">
                    <div class="colorBox" style="background-color: #0A8136;"></div>
                    <div class="values">
                        <div class="value" style="font-size: 24px;">1159</div>
                    </div>
                </div>
                <div class="colorValueContainer">
                    <div class="colorBox" style="background-color: #027D30;"></div>
                    <div class="values">
                        <div class="value" style="font-size: 24px;">1198</div>
                    </div>
                </div>
                <div class="colorValueContainer">
                    <div class="colorBox" style="background-color: #007D30;"></div>
                    <div class="values">
                        <div class="value" style="font-size: 24px;">1237</div>
                    </div>
                </div>
            </div>
            <div class="closenitrogenLegend">
                <i class="material-icons">cancel</i>
            </div>
        </div>




        <div id="northArrow" class="northArrow">
            <i class="material-icons" style="color: #FF6666;">navigation</i>
        </div>




        <div id="basemapswitcher" class="basemapswitcher">
            <button id="basemapBtn" class="basemapBtn" onclick="cycleBasemap()">
                <i class="material-icons">layers</i>
            </button>
        </div>

        <div class="basemapSelector" id="basemapSelector">
            <div class="container-content">
                <h2>Chọn bản đồ cơ sở</h2>
                <div class="close-bm-button" onclick="closeBasemapSelector()">
                    <i class="material-icons">cancel</i>
                </div>
                <div class="image-container">
                    <div onclick="selectBasemap(1)" style="position: relative;">
                        <img src="https://i.ibb.co/Jjg7bMD/bm-street.png" alt="Đường phố">
                        <div class="osminfo-icon" style="position: absolute; top: 20px; left: 20px;">
                            <i class="material-icons"
                                style="font-size: 50px; color: white; text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);">info</i>
                        </div>
                        <div class="caption">Đường phố</div>
                        <div class="selected-basemap-circle"></div>
                    </div>

                    <div onclick="selectBasemap(2)" style="position: relative;">
                        <img src="https://i.ibb.co/j3fq23k/bm-imagery.png" alt="Hình ảnh" border="0">
                        <div class="mapboxinfo-icon" style="position: absolute; top: 20px; left: 20px;">
                            <i class="material-icons"
                                style="font-size: 50px; color: white; text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);">info</i>
                        </div>
                        <div class="caption">Hình ảnh</div>
                        <div class="selected-basemap-circle"></div>
                    </div>

                    <div onclick="selectBasemap(0)" style="position: relative;">
                        <img src="https://i.ibb.co/VM1tBQj/bm-carbon.png" alt="bm-carbon" border="0">
                        <div class="info-icon" style="position: absolute; top: 20px; left: 20px;">
                            <i class="material-icons"
                                style="font-size: 50px; color: white; text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);">info</i>
                        </div>
                        <div class="caption">Cổ phiếu carbon</div>
                        <div class="selected-basemap-circle"></div>
                    </div>


                    <div onclick="selectBasemap(3)" style="position: relative;">
                        <img src="https://i.ibb.co/n73N7QY/bm-ph.png" alt="Bản đồ pH" border="0">
                        <div class="info-icon" style="position: absolute; top: 20px; left: 20px;">
                            <i class="material-icons"
                                style="font-size: 50px; color: white; text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);">info</i>
                        </div>
                        <div class="caption">Bản đồ pH</div>
                        <div class="selected-basemap-circle"></div>
                    </div>

                    <div onclick="selectBasemap(4)" style="position: relative;">
                        <img src="https://i.ibb.co/Krtp9sf/bm-nitrogen.png" alt="Nito" border="0">
                        <div class="info-icon" style="position: absolute; top: 20px; left: 20px;">
                            <i class="material-icons"
                                style="font-size: 50px; color: white; text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);">info</i>
                        </div>
                        <div class="caption">Nito</div>
                        <div class="selected-basemap-circle"></div>
                    </div>


                    <!--<div onclick="selectBasemap(0)">
                        <img src="https://i.ibb.co/vYWN6F0/bm-soil.png" alt="Lớp đất" border="0">
                        <div class="caption">Lớp đất</div>
                        <div class="selected-basemap-circle"></div>
                    </div> Soil Map-->


                </div>
            </div>
        </div>

        <button id="searchBtn" class="searchBtn">
            <i class="material-icons">search</i>
        </button>

        <div id="searchBar" class="searchBar" style="display: none;">
            <input id="searchInput" class="searchInput" type="text" placeholder="  Tra Cứu.."
                style="font-size: 40px;" />
            <!--Search for a place...-->
            <div id="loadingIcon" class="loadingIcon" style="visibility: hidden; margin-left: -30px;">
                <i class="material-icons"
                    style="font-size: 80px; color: #515151; animation: spin 1s infinite linear; margin-right: -30px;">
                    sync
                </i>
            </div>
            <div id="suggestionsContainer" class="suggestionsContainer"></div>
            <button id="searchButton" class="searchButton">
                <i class="material-icons">search</i>
            </button>
        </div>


        <!--<button id="searchKeywordBtn" class="searchKeywordBtn">Search Keyword Button</button>-->


        <div id="suggestionsContainer"></div>

        <button id="measureAreaBtn" class="measureAreaBtn" onclick="startMeasurementArea()">
            <i class="material-icons">square_foot</i>
        </button>

        <button id="measureLengthBtn" class="measureLengthBtn" onclick="startMeasurementLength()">
            <i class="material-icons">straighten</i>
        </button>

        <!--<button id="drawFarmBtn" class="drawFarmBtn" onclick="startDrawingFarm()">
            <i class="material-icons">create</i>
        </button>-->

        <button id="sketchFarmBtn" class="sketchFarmBtn">
            <i class="material-icons">create</i>
        </button>

        <button id="addSensorBtn" class="addSensorBtn">
            <i class="material-icons">sensors</i>
        </button>



        <button id="tutorialBtn">
            <i class="material-icons">info</i>
        </button>

        <button id="clearAllDrawingBtn" class="hidden">
            <i class="material-icons">delete</i>
        </button>

        <button id="resetBtn">
            <i class="material-icons">restart_alt</i>
        </button>


        <!--Delete Confirm Dialog Box-->
        <div id="dialog" class="dialog hidden">
            <div class="dialog-content">
                <div style="display: flex; flex-direction: column; align-items: center; justify-content: center;">
                    <i class="material-icons" style="font-size: 120px; color: #FF6666; margin-bottom: 10px;">warning</i>
                    <p style="margin: 0; margin-bottom: 30px;">Bạn có muốn xóa bản vẽ?</p>
                </div>
                <div style="display: flex; justify-content: center;">
                    <button id="deleteYes" class="dialog-button"
                        style="background-color: #FF6666; color: white; display: flex; align-items: center;">
                        <i class="material-icons" style="font-size: 50px; margin-right: 8px;">delete_forever</i>
                        <span>Đúng</span>
                    </button>
                    <button id="deleteNo" class="dialog-button"
                        style="background-color: white; color: #515151; border: 2px solid #A9A9A9;">Không</button>

                </div>
            </div>
        </div>


        <!--Finish Sketch Button-->
        <div class="sketch-buttons">
            <button id="finishDrawingButton" class="finish-drawing hidden"
                style="font-size: 40px; background-color: #386c34; color: white;">
                <span class="material-icons" style="font-size: 40px;">done_outline</span>
                Hoàn Thành
            </button>
        </div>


        <button id="locationBtn" class="locationBtn" onclick="getUserLocation()">
            <i class="material-icons">gps_fixed</i>
        </button>

        <div class="isric-attribution">
            <i class="material-icons close-button" onclick="closeAttribution('.isric-attribution')">cancel</i>
            <br>
            <br>
            <p>Đây là một phần của SoilGrids Maps và được quản lý bởi ISRIC (International Soil Reference and
                Information Centre)</p>
            <!--<p>This map is part of SoilGrids Maps and is maintained by ISRIC (International Soil Reference and
                Information Centre).</p>-->
            <br>
            <!--<p>Local accuracy is not guaranteed. To know more about the SoilGrids Maps Programme, click on this <span
                        class="hidden-link"
                        onclick="window.open('https://www.isric.org/explore/soilgrids/faq-soilgrids', '_blank')">link</span>.
            </p>-->
            <p>Độ chính xác cục bộ không được đảm bảo. Để biết thêm về Chương trình SoilGrids Maps, hãy nhấp vào đây
                <span class="hidden-link"
                    onclick="window.open('https://www.isric.org/explore/soilgrids/faq-soilgrids', '_blank')">link</span>.
            </p>
        </div>

        <div class="osm-attribution">
            <i class="material-icons close-button" onclick="closeAttribution('.osm-attribution')">cancel</i>
            <br><br>
            <p>Map data <a href="https://www.openstreetmap.org/" target="_blank">© OpenStreetMap contributors</a></p>
        </div>

        <div class="mapbox-attribution">
            <i class="material-icons close-button" onclick="closeAttribution('.mapbox-attribution')">cancel</i>
            <br><br>
            <p>Map data <a href="https://www.mapbox.com/" target="_blank">© Mapbox</a></p>
        </div>


        <script>









            //Display ISRIC Maps Legend
            function addCloseEventListener(elementId, targetId) {
                document.querySelector(elementId).addEventListener('click', function () {
                    document.getElementById(targetId).style.display = 'none';
                });
            }

            addCloseEventListener('.closecarbonLegend', 'carbonlegend');
            addCloseEventListener('.closepHLegend', 'pHlegend');
            addCloseEventListener('.closenitrogenLegend', 'nitrogenlegend');




            ///// MAP PRODUCT TOUR \\\\\
            // Check if the tour has already been shown
            const tourShown = localStorage.getItem('tourShown');

            if (!tourShown) {
                // Ensure Shepherd.js is loaded before using it
                window.addEventListener('DOMContentLoaded', () => {
                    // Create a new instance of Shepherd
                    const tour = new Shepherd.Tour({
                        useModalOverlay: true,
                        defaultStepOptions: {
                            classes: 'shadow-md bg-purple-dark',
                            scrollTo: true,
                        },
                    });
                    // Define the steps of the tour
                    tour.addStep({
                        id: 'step-search',
                        text: '<span style="font-size: 40px;">Nhấp vào nút này để tìm kiếm các địa điểm.</span>', //Click this button to search for places.
                        attachTo: {
                            element: '#searchBtn',
                            on: 'left',
                        },
                        buttons: [
                            {
                                text: '<span style="font-size: 40px;">Kế tiếp</span>', //Next
                                action: tour.next,
                            },
                        ],
                    });


                    tour.addStep({
                        id: 'step-basemap',
                        text: '<span style="font-size: 40px;">Nhấp vào nút này để chuyển đổi bản đồ cơ sở.</span>', //Click this button to switch basemaps.
                        attachTo: {
                            element: '#basemapBtn',
                            on: 'left',
                        },
                        buttons: [
                            {
                                text: '<span style="font-size: 40px;">Kế tiếp</span>', //Next
                                action: tour.next,
                            },
                        ],
                    });

                    tour.addStep({
                        id: 'step-measure-area',
                        text: '<span style="font-size: 40px;">Bấm vào nút này để đo diện tích.</span>', //Click this button to measure area.
                        attachTo: {
                            element: '#measureAreaBtn',
                            on: 'left',
                        },
                        buttons: [
                            {
                                text: '<span style="font-size: 40px;">Kế tiếp</span>', //Next
                                action: tour.next,
                            },
                        ],
                    });

                    tour.addStep({
                        id: 'step-measure-length',
                        text: '<span style="font-size: 40px;">Bấm vào nút này để đo chiều dài.</span>', //Click this button to measure length.
                        attachTo: {
                            element: '#measureLengthBtn',
                            on: 'left',
                        },
                        buttons: [
                            {
                                text: '<span style="font-size: 40px;">Kế tiếp</span>', //Next
                                action: tour.next,
                            },
                        ],
                    });

                    tour.addStep({
                        id: 'step-sketch-farm',
                        text: '<span style="font-size: 40px;">Nhấp vào nút này để phác thảo trang trại của bạn.</span>', //Click this button to sketch your farms.
                        attachTo: {
                            element: '#sketchFarmBtn',
                            on: 'left',
                        },
                        buttons: [
                            {
                                text: '<span style="font-size: 40px;">Kế tiếp</span>', //Next
                                action: tour.next,
                            },
                        ],
                    });

                    tour.addStep({
                        id: 'step-add-sensor',
                        text: '<span style="font-size: 40px;">Nhấp vào nút này để thêm/các cảm biến enfarm.</span>', //Click this button to add enfarm sensor/s.
                        attachTo: {
                            element: '#addSensorBtn',
                            on: 'left',
                        },
                        buttons: [
                            {
                                text: '<span style="font-size: 40px;">Kế tiếp</span>', //Next
                                action: tour.next,
                            },
                        ],
                    });


                    tour.addStep({
                        id: 'step-reset',
                        text: '<span style="font-size: 40px;">Nhấp vào nút này để đặt lại bản đồ.</span>', //Click this button to reset the map.
                        attachTo: {
                            element: '#resetBtn',
                            on: 'left',
                        },
                        buttons: [
                            {
                                text: '<span style="font-size: 40px;">Kế tiếp</span>', //Next
                                action: tour.next,
                            },
                        ],
                    });


                    tour.addStep({
                        id: 'step-reset',
                        text: '<span style="font-size: 40px;">Nhấp vào nút này để xem lại hướng dẫn.</span>', //Click this button to show the guide again
                        attachTo: {
                            element: '#tutorialBtn',
                            on: 'left',
                        },
                        buttons: [
                            {
                                text: '<span style="font-size: 40px;">Làm lại</span>', //Repeat
                                action: () => {
                                    tour.show('step-search');
                                },
                                classes: 'shepherd-button-secondary',
                            },
                            {
                                text: '<span style="font-size: 40px;">Xong</span>', //Done
                                action: () => {
                                    // Mark the tour as shown in the browser storage
                                    localStorage.setItem('tourShown', true);
                                    tour.complete();
                                },
                            },
                        ],
                    });

                    // Start the tour
                    tour.start();
                });
            }

            //RESET PRODUCT TOUR
            function resetProductTour() {
                // Clear the tourShown item from localStorage
                localStorage.removeItem('tourShown');

                // Reload the page to show the product tour again
                location.reload();
            }

            // Get the tutorial button element
            const tutorialBtn = document.getElementById('tutorialBtn');

            // Add event listener to the button
            tutorialBtn.addEventListener('click', resetProductTour);


            ////// SEARCH PLACE BUTTON FUNCTION \\\\\
            const searchBtn = document.getElementById("searchBtn");
            const searchBar = document.getElementById("searchBar");
            const searchInput = document.getElementById("searchInput");
            const searchKeywordBtn = document.getElementById("searchKeywordBtn");
            const floatingMessage = document.getElementById("floatingMessage");
            const suggestionsContainer = document.getElementById("suggestionsContainer");
            const searchIcon = document.getElementById("searchButton").querySelector(".material-icons");

            let historicalPlaces = [];

            searchBtn.addEventListener("click", handleSearchClick);
            document.addEventListener("click", handleDocumentClick);
            searchInput.addEventListener("input", toggleSearchIcon);
            searchInput.addEventListener("click", displayHistoricalPlacesOnClick);
            searchIcon.addEventListener("click", handleSearchIconClick);


            //const searchInput = document.getElementById("searchInput");
            const placeholderTexts = [
                "  Tra Cứu..",
                "  Tra Cứu Cho Một Mốc",
                "  Tra Cứu Cho Một Huyện",
                "  Tra Cứu Cho Một Xã",
                "  Tra Cứu.."
            ];
            let placeholderIndex = 0;
            let placeholderTimeout;

            function showNextPlaceholder() {
                const placeholder = placeholderTexts[placeholderIndex];
                let i = 0;

                const typingInterval = setInterval(() => {
                    if (i < placeholder.length) {
                        searchInput.setAttribute("placeholder", placeholder.substring(0, i + 1));
                        i++;
                    } else {
                        clearInterval(typingInterval);
                        if (placeholderIndex < placeholderTexts.length - 1) {
                            placeholderIndex++;
                            placeholderTimeout = setTimeout(showNextPlaceholder, 1000);
                        }
                    }
                }, 15);
            }

            // Add event listener to start the transition when the search input is focused
            searchInput.addEventListener("focus", () => {
                // Start the placeholder transition if it hasn't been started yet
                if (!placeholderTimeout) {
                    showNextPlaceholder();
                }
            });

            // Add event listener to stop the transition when the search input is blurred
            searchInput.addEventListener("blur", () => {
                clearTimeout(placeholderTimeout);
                placeholderTimeout = null;
                searchInput.setAttribute("placeholder", "");
            });




            function toggleSearchIcon() {
                if (searchInput.value.length > 0) {
                    searchIcon.textContent = "cancel";
                } else {
                    searchIcon.textContent = "search";
                }
            }

            function handleSearchIconClick() {
                if (searchIcon.textContent === "cancel") {
                    searchInput.value = "";
                    toggleSearchIcon();
                    clearPlaceSuggestions();
                    displayHistoricalPlaces();
                }
            }

            function handleSearchClick(event) {
                event.stopPropagation();
                searchBtn.style.display = "none";
                searchBar.style.display = "flex";
                //searchKeywordBtn.style.display = "none";
                searchInput.focus();

                // Clear the search input and suggestions
                searchInput.value = "";
                clearPlaceSuggestions();

                displayHistoricalPlaces();


                // Post a message to the React Native app
                //const message = { actionType: 'Search', event: 'click' };
                //window.ReactNativeWebView.postMessage(JSON.stringify(message));

                try {
                    const message = { actionType: 'Search', event: 'click' };
                    window.ReactNativeWebView.postMessage(JSON.stringify(message));
                } catch (error) {
                    // Handle the error (or do nothing to prevent logging)

                }
            }


            function displayHistoricalPlacesOnClick() {
                if (searchInput.value.trim().length === 0) {
                    searchInput.value = "";
                    displayHistoricalPlaces();
                }
            }

            function handleDocumentClick(event) {
                if (
                    !searchBar.contains(event.target) &&
                    event.target !== searchBtn &&
                    event.target !== searchKeywordBtn &&
                    event.target !== floatingMessage
                ) {
                    searchBtn.style.display = "block";
                    searchBar.style.display = "none";
                    searchInput.value = "";
                    suggestionsContainer.style.display = "none";
                }
            }

            function clearPlaceSuggestions() {
                suggestionsContainer.innerHTML = '';
            }

            searchBar.style.display = "none";


            let markerLayer;

            function createMarker(coordinates) {
                if (markerLayer) {
                    map.removeLayer(markerLayer);
                }

                const marker = new ol.Feature({
                    geometry: new ol.geom.Point(coordinates),
                });

                const markerStyle = new ol.style.Style({
                    image: new ol.style.Circle({
                        radius: 22,
                        fill: new ol.style.Fill({
                            color: "#ff6666",
                        }),
                        stroke: new ol.style.Stroke({
                            color: "rgba(255, 255, 255, 0.8)",
                            width: 12,
                        }),
                        shadow: new ol.style.Circle({
                            radius: 18,
                            fill: new ol.style.Fill({
                                color: "rgba(0, 0, 0, 0.5)", // Set the shadow color and transparency
                            }),
                        }),
                    }),
                });

                marker.setStyle(markerStyle);

                markerLayer = new ol.layer.Vector({
                    source: new ol.source.Vector({
                        features: [marker],
                    }),
                });

                map.addLayer(markerLayer);



                // Define the addressParts variable outside the fetchPlaceName function
                let addressParts = [];

                // Fetch place name using coordinates from OSM Nominatim
                fetchPlaceName(coordinates)
                    .then((placeName) => {
                        // Create label overlay
                        const label = new ol.Overlay({
                            position: coordinates,
                            element: document.createElement("div"),
                            offset: [0, -45],
                            positioning: "bottom-center",
                        });

                        const labelElement = label.getElement();

                        // Create the pill-shaped background container
                        const pillContainer = document.createElement("div");
                        pillContainer.style.display = "flex";
                        pillContainer.style.alignItems = "center";
                        pillContainer.style.justifyContent = "space-between";
                        pillContainer.style.background = "#ffffff";
                        pillContainer.style.padding = "10px 40px";
                        pillContainer.style.borderRadius = "100px";
                        pillContainer.style.boxShadow = "0 4px 8px rgba(0, 0, 0, 0.15)";

                        // Create the place name element
                        const placeNameElement = document.createElement("span");
                        placeNameElement.textContent = placeName;
                        placeNameElement.style.fontSize = "40px";
                        placeNameElement.style.fontFamily = "Be Vietnam Pro', Arial, sans-serif";
                        placeNameElement.style.color = "#515151";
                        placeNameElement.style.textShadow = "2px 2px 4px rgba(255, 255, 255, 0.5)";
                        placeNameElement.style.letterSpacing = "1px";

                        // Create the chevron_right icon element
                        const chevronIcon = document.createElement("i");
                        chevronIcon.classList.add("material-icons");
                        chevronIcon.textContent = "expand_circle_down";
                        chevronIcon.style.fontSize = "60px";
                        chevronIcon.style.color = "#515151";
                        chevronIcon.style.marginLeft = "15px";

                        // Add hover effect to the chevron icon
                        chevronIcon.style.cursor = "pointer";

                        // Append the place name element and chevron icon to the pill container
                        pillContainer.appendChild(placeNameElement);
                        pillContainer.appendChild(chevronIcon);

                        // Set the pill container as the label element
                        labelElement.appendChild(pillContainer);



                        // Ensure that 'pillContainer' is defined before this block

                        // Check that pillContainer is not null before adding an event listener
                        if (pillContainer) {
                            // Add transition effect to the pillContainer
                            pillContainer.style.transition = "all 0.3s ease-in-out";

                            pillContainer.addEventListener("click", event => {
                                if (event.target.classList.contains('material-icons')) {
                                    const addressDetails = addressParts.slice(1).join(", ");

                                    // Add hover effect and transition to the chevron icon
                                    const chevronIcon = pillContainer.querySelector("i.material-icons");
                                    if (chevronIcon) {
                                        chevronIcon.style.transition = "transform 0.3s ease-in-out"; // Add transition effect to the chevron icon

                                        chevronIcon.addEventListener("mouseenter", () => {
                                            chevronIcon.style.color = "#999999";
                                        });

                                        chevronIcon.addEventListener("mouseleave", () => {
                                            chevronIcon.style.color = "#515151";
                                        });
                                    }

                                    if (pillContainer.getAttribute('data-expanded') === 'true') {
                                        pillContainer.innerHTML = `
      <span style="font-size: 40px; font-family: 'Be Vietnam Pro', Arial, sans-serif; color: #515151; text-align: center; display: flex; align-items: center;">
        <span>${placeName}</span>
        <button style="font-size: 60px; color: inherit; background-color: transparent; border: none; cursor: pointer; display: flex; align-items: center; margin-left: 10px;">
          <i class="material-icons" style="transform: rotate(0deg); font-size: inherit; transition: transform 0.3s ease-in-out;">expand_circle_down</i>
        </button>
      </span>`;

                                        pillContainer.style.width = "initial";
                                        pillContainer.style.padding = "10px 40px";
                                        pillContainer.style.borderRadius = "100px";
                                        pillContainer.setAttribute('data-expanded', 'false');

                                    } else if (addressParts.length > 0) {
                                        pillContainer.innerHTML = `
      <span style="font-size: 40px; font-family: 'Be Vietnam Pro', Arial, sans-serif; color: #515151; text-align: center;">
        <strong>${placeName}</strong>, ${addressDetails}
        <button style="font-size: 60px; color: inherit; background-color: transparent; border: none; cursor: pointer; display: flex; align-items: center; margin-left: 430px;">
          <i class="material-icons" style="transform: rotate(180deg); font-size: inherit; transition: transform 0.3s ease-in-out;">expand_circle_down</i>
        </button>
      </span>`;

                                        pillContainer.style.width = "500px";
                                        pillContainer.style.padding = "30px 30px";
                                        pillContainer.style.borderRadius = "20px";
                                        pillContainer.setAttribute('data-expanded', 'true');
                                    }
                                }
                            });
                        }

                        // Set the pill container as the label element
                        labelElement.appendChild(pillContainer);

                        // Add the label overlay to the map
                        map.addOverlay(label);
                    })
                    .catch((error) => {
                        console.error("Failed to fetch place name:", error);
                    });


                // Function to fetch place name from OSM Nominatim
                async function fetchPlaceName(coordinates) {
                    const [lon, lat] = ol.proj.toLonLat(coordinates);
                    const baseUrl = "https://nominatim.openstreetmap.org/reverse";
                    const format = "json";
                    const url = `${baseUrl}?lon=${lon}&lat=${lat}&format=${format}&zoom=18&addressdetails=1`;

                    try {
                        const response = await fetch(url);
                        if (response.ok) {
                            const data = await response.json();
                            addressParts = data.display_name.split(",");
                            const placeName = addressParts[0]?.trim() || "";
                            return placeName;
                        } else {
                            console.error("Failed to fetch place name:", response.status, response.statusText);
                            return "";
                        }
                    } catch (error) {
                        console.error("Failed to fetch place name:", error);
                        return "";
                    }
                }

            }


            // Function to fetch place suggestions from OSM-Nominatim
            async function fetchPlaceSuggestions(searchText) {
                const baseUrl = "https://nominatim.openstreetmap.org/search";
                const format = "json";
                const limit = 25;
                const url = `${baseUrl}?q=${encodeURIComponent(searchText)}&format=${format}&limit=${limit}&countrycodes=VN`;

                try {
                    const loadingIcon = document.getElementById("loadingIcon");
                    const searchButton = document.getElementById("searchButton");

                    loadingIcon.style.visibility = "visible"; // Show the loading icon
                    loadingIcon.classList.add("spin"); // Add the spin class
                    searchButton.style.visibility = "hidden"; // Hide the search icon

                    const response = await fetch(url);
                    if (response.ok) {
                        const data = await response.json();
                        const filteredSuggestions = data.filter(
                            (place) =>
                                !historicalPlaces.some(
                                    (historicalPlace) =>
                                        historicalPlace.display_name === place.display_name
                                )
                        );

                        // Process the suggestions...

                        return filteredSuggestions.map((place) => ({
                            display_name: place.display_name,
                            lat: place.lat,
                            lon: place.lon,
                        }));
                    } else {
                        console.error(
                            "Failed to fetch place suggestions:",
                            response.status,
                            response.statusText
                        );
                        return [];
                    }
                } catch (error) {
                    console.error("Failed to fetch place suggestions:", error);
                    return [];
                } finally {
                    const loadingIcon = document.getElementById("loadingIcon");
                    const searchButton = document.getElementById("searchButton");

                    // Delay the visibility of the search button for 2 seconds (2000 milliseconds)
                    setTimeout(() => {
                        loadingIcon.classList.remove("spin"); // Remove the spin class
                        loadingIcon.style.visibility = "hidden"; // Hide the loading icon
                        searchButton.style.visibility = "visible"; // Show the search icon
                    }, 3000);
                }
            }


            // Function to display place suggestions below the search bar
            function displayPlaceSuggestions(suggestions) {
                suggestionsContainer.innerHTML = "";

                // Combine historical places with fetched suggestions
                const allSuggestions = [...suggestions, ...historicalPlaces];

                allSuggestions.forEach((suggestion, index) => {
                    const suggestionItem = document.createElement("div");
                    suggestionItem.classList.add("suggestionItem");
                    suggestionItem.style.paddingTop = "20px";
                    suggestionItem.style.paddingBottom = "20px";

                    const gpsIcon = document.createElement("i");
                    gpsIcon.classList.add("material-icons", "gpsIcon");

                    // Use "history" icon for historical places
                    if (historicalPlaces.includes(suggestion)) {
                        gpsIcon.textContent = "history";
                        gpsIcon.style.fontSize = "60px"
                    } else {
                        gpsIcon.textContent = "north_east";
                        gpsIcon.style.fontSize = "60px"
                    }

                    const suggestionText = document.createElement("span");
                    suggestionText.textContent = suggestion.display_name;
                    suggestionText.classList.add("suggestionText");
                    suggestionText.style.color = "#515151";
                    suggestionText.style.fontFamily = "Be Vietnam Pro', Arial, sans-serif";

                    suggestionItem.addEventListener("click", () => {
                        handleSuggestionClick(suggestion);
                    });

                    suggestionItem.appendChild(gpsIcon);
                    suggestionItem.appendChild(suggestionText);
                    suggestionsContainer.appendChild(suggestionItem);

                    // Add a horizontal line after displaying suggestions
                    if (index === suggestions.length - 1) {
                        const separatorContainer = document.createElement("div");
                        separatorContainer.style.paddingTop = "50px";
                        separatorContainer.style.paddingBottom = "50px";

                        const separatorLine = document.createElement("hr");
                        separatorLine.style.width = "50%";
                        separatorLine.style.margin = "0 auto";
                        separatorContainer.appendChild(separatorLine);

                        suggestionsContainer.appendChild(separatorContainer);

                        // Add the text below the line
                        const historicalPlacesText = document.createElement("div");
                        historicalPlacesText.textContent = "Địa điểm đã tìm kiếm trước đây";
                        historicalPlacesText.style.fontSize = "40px";
                        historicalPlacesText.style.color = "#515151";
                        historicalPlacesText.style.marginLeft = "20px";
                        historicalPlacesText.style.fontFamily = "Be Vietnam Pro', Arial, sans-serif";
                        suggestionsContainer.appendChild(historicalPlacesText);
                    }
                });

                suggestionsContainer.style.display = "block";
            }

            // Attach event listener to the search input
            searchInput.addEventListener("input", handleSearchInput);

            let searchTimeout;

            // Attach event listener to the search input
            searchInput.addEventListener("input", handleSearchInputWithDelay);

            function handleSearchInputWithDelay() {
                clearTimeout(searchTimeout);
                searchTimeout = setTimeout(handleSearchInput, 1000); // Adjust the delay duration as needed (in milliseconds)
            }


            // Function to handle search input
            function handleSearchInput() {
                const searchText = searchInput.value.trim();

                if (searchText.length > 0) {
                    fetchPlaceSuggestions(searchText)
                        .then((suggestions) => {
                            displayPlaceSuggestions(suggestions);
                        })
                        .catch((error) => {
                            console.error("Failed to fetch place suggestions:", error);
                        });

                    const historicalPlacesContainer = document.getElementById("historicalPlacesContainer");

                    // Wrap the code inside a DOM ready event listener
                    document.addEventListener("DOMContentLoaded", function () {
                        // Retrieve the historicalPlacesContainer element
                        const historicalPlacesContainer = document.getElementById("historicalPlacesContainer");

                        // Check if the historicalPlacesContainer element exists
                        if (historicalPlacesContainer) {
                            // Handle the search input
                            handleSearchInput();
                        }

                        // Function to handle the search input
                        function handleSearchInput() {
                            // Retrieve the search input element
                            const searchInput = document.getElementById("searchInput");
                            // Retrieve the suggestions container element
                            const suggestionsContainer = document.getElementById("suggestionsContainer");

                            // Check if the search input is empty
                            if (searchInput.value.trim() !== "") {
                                // Show suggestions and hide historical places list
                                suggestionsContainer.style.display = "block";
                                historicalPlacesContainer.style.display = "none";
                            } else {
                                // If the search input is empty, hide historical places and suggestions container
                                suggestionsContainer.style.display = "none";
                                historicalPlacesContainer.style.display = "none";
                            }
                        }
                    });
                }
            }
            // Attach event listener to the search input
            searchInput.addEventListener("input", handleSearchInput);

            function handleSuggestionClick(suggestion) {
                const latitude = parseFloat(suggestion.lat);
                const longitude = parseFloat(suggestion.lon);
                const center = ol.proj.fromLonLat([longitude, latitude]);

                // Smoothly animate the zoom and centering
                map.getView().animate({
                    center: center,
                    zoom: 21,
                    duration: 1000, // Adjust the duration as needed
                    easing: ol.easing.easeOut // Use a suitable easing function for smooth animation
                });

                const coordinates = ol.proj.fromLonLat([longitude, latitude]);
                createMarker(coordinates);

                // Post a message to the React Native app
                const message = {
                    actionType: 'Search',
                    event: 'select',
                    locationText: suggestion.display_name,
                    latitude: latitude,
                    longitude: longitude
                };
                try {
                    window.ReactNativeWebView.postMessage(JSON.stringify(message));
                } catch (error) {
                    // Handle the error (or do nothing to prevent logging)
                }

                // Log the address and lon/lat to the console
                const address = suggestion.display_name;
                const lon = suggestion.lon;
                const lat = suggestion.lat;
                console.log('Selected Place:');
                console.log('Address:', address);
                console.log('Lon/Lat:', lon, lat);

                // Check if the selected place already exists in historicalPlaces
                const existingPlaceIndex = historicalPlaces.findIndex(
                    (place) => place.display_name === suggestion.display_name
                );

                if (existingPlaceIndex === -1) {
                    // Add the selected place to the historicalPlaces array
                    historicalPlaces.push(suggestion);

                    // Save the historicalPlaces in local storage
                    localStorage.setItem("historicalPlaces", JSON.stringify(historicalPlaces));
                } else {
                    // If the place already exists, move it to the end of the array
                    const existingPlace = historicalPlaces.splice(existingPlaceIndex, 1);
                    historicalPlaces.push(existingPlace[0]);
                }

                // Display historical places
                displayHistoricalPlaces();

                // Clear the search input
                searchInput.value = "";
                suggestionsContainer.style.display = "none";
            }


            function displayHistoricalPlaces() {
                suggestionsContainer.innerHTML = "";

                if (historicalPlaces.length > 0 && searchInput.value.trim() === "") {
                    const sortedPlaces = [...historicalPlaces].reverse();
                    const recentPlaces = sortedPlaces.slice(0, 8);

                    recentPlaces.forEach((place) => {
                        const suggestionItem = document.createElement("div");
                        suggestionItem.classList.add("suggestionItem");
                        suggestionItem.style.paddingTop = "20px";
                        suggestionItem.style.paddingBottom = "20px";

                        const gpsIcon = document.createElement("i");
                        gpsIcon.classList.add("material-icons", "gpsIcon");
                        gpsIcon.textContent = "history";
                        gpsIcon.style.fontSize = "60px"; //adjust history icon size

                        const suggestionText = document.createElement("span");
                        suggestionText.textContent = place.display_name;
                        suggestionText.classList.add("suggestionText");
                        suggestionText.style.color = "#515151";

                        const deleteButton = document.createElement("button");
                        deleteButton.classList.add("deleteButton");
                        deleteButton.innerHTML = '<i class="material-icons" style="font-size: 50px;">close</i>';

                        deleteButton.addEventListener("click", (event) => {
                            event.stopPropagation();
                            deleteHistoricalPlace(place);
                        });

                        suggestionItem.addEventListener("click", () => {
                            handleSuggestionClick(place);
                        });

                        deleteButton.addEventListener("click", (event) => {
                            event.stopPropagation();
                            deleteHistoricalPlace(place);
                        });

                        suggestionItem.appendChild(gpsIcon);
                        suggestionItem.appendChild(suggestionText);
                        suggestionItem.appendChild(deleteButton);

                        suggestionsContainer.appendChild(suggestionItem);
                    });

                    // Function to delete individual historical place
                    function deleteHistoricalPlace(place) {
                        // Find the index of the place in the historicalPlaces array
                        const index = historicalPlaces.findIndex((p) => p.display_name === place.display_name);

                        if (index !== -1) {
                            // Remove the place from the historicalPlaces array
                            historicalPlaces.splice(index, 1);

                            // Save the updated historicalPlaces in local storage
                            localStorage.setItem("historicalPlaces", JSON.stringify(historicalPlaces));

                            // Re-display the historical places
                            displayHistoricalPlaces();
                        }
                    }

                    // Create the Clear all search history button
                    const clearAllButton = document.createElement("button");
                    clearAllButton.id = "clearAllBtn";
                    clearAllButton.innerHTML = `
<div style="display: flex; align-items: center; justify-content: center; width: 840px; margin: 0 auto; padding-bottom: 30px; padding-top: 30px; font-family: 'Be Vietnam Pro', Arial, sans-serif;">
  <i class="material-icons" style="font-size: 40px; margin-right: 20px;">delete</i>
  <span style="font-size: 45px; color: #515151;">Xóa tất cả tìm kiếm</span> 
</div>`;



                    clearAllButton.addEventListener("click", clearAllHistory);
                    suggestionsContainer.appendChild(clearAllButton);

                } else {
                    const noResultsText = document.createElement("div");
                    noResultsText.style.display = "flex";
                    noResultsText.style.alignItems = "center";
                    noResultsText.style.fontSize = "40px";
                    noResultsText.style.marginLeft = "40px";
                    noResultsText.style.color = "#515151";

                    const historyIcon = document.createElement("i");
                    historyIcon.classList.add("material-icons");
                    historyIcon.textContent = "history";
                    historyIcon.style.fontSize = "60px";
                    historyIcon.style.marginRight = "40px"; // Increased separation

                    const text = document.createElement("span");
                    text.textContent = "Không có địa điểm nào được tìm kiếm trước đó";

                    noResultsText.appendChild(historyIcon);
                    noResultsText.appendChild(text);
                    suggestionsContainer.appendChild(noResultsText);



                }

                suggestionsContainer.style.display = "block";
            }

            // Function to clear all historical places
            function clearAllHistory() {
                historicalPlaces = [];
                localStorage.removeItem("historicalPlaces");
                displayHistoricalPlaces();
            }

            // Retrieve historical places from local storage
            const savedHistoricalPlaces = localStorage.getItem("historicalPlaces");
            if (savedHistoricalPlaces) {
                historicalPlaces = JSON.parse(savedHistoricalPlaces);
            }

            // Attach event listener to the search input
            searchInput.addEventListener("input", handleSearchInput);





            <!------------------------------------------------------------------------------------------------>

            ///// BASEMAP SWITCHER BUTTON \\\\\
            function cycleBasemap() {
                const basemapSelector = document.getElementById("basemapSelector");

                if (basemapSelector.style.display === "block") {
                    // If basemapSelector is already displayed, dismiss it
                    basemapSelector.style.transform = "translateX(-50%) translateY(100%)";
                    setTimeout(() => {
                        basemapSelector.style.display = "none";
                    }, 300);
                } else {
                    // If basemapSelector is not displayed, call it
                    basemapSelector.style.display = "block";

                    // Move the basemapSelector up slightly to avoid scrolling
                    basemapSelector.style.transform = "translateX(-50%) translateY(-10px)";

                    // Trigger the animation by setting the transform property to 0
                    setTimeout(() => {
                        basemapSelector.style.transform = "translateX(-50%) translateY(0)";
                    }, 0);
                }
            }

            // BASEMAP SELECTION FUNCTIONALITY
            const mapElement = document.getElementById("map");

            // Layers
            const satelliteLayer = new ol.layer.Tile({
                source: new ol.source.XYZ({
                    url: 'https://api.mapbox.com/styles/v1/mapbox/satellite-v9/tiles/{z}/{x}/{y}?access_token=pk.eyJ1IjoiY21sb3NhcmlhIiwiYSI6ImNsZGJ4cHp2ajAwMGszb3FmeXpxYmVpMHkifQ.3wsPFc9FkszxcH27eEq2dw',
                    tileSize: 512,
                    maxZoom: 22,
                    attribution: '© <a href="https://www.mapbox.com">Mapbox</a>',
                    crossOrigin: 'anonymous'
                }),
                visible: false // set visibility to false initially
            });

            const streetLayer = new ol.layer.Tile({
                source: new ol.source.XYZ({
                    url: "https://{a-c}.tile.openstreetmap.org/{z}/{x}/{y}.png",
                    attributions: '© <a href="https://www.openstreetmap.org">OpenStreetMap</a> contributors',
                    maxZoom: 19,
                }),
                visible: true // set visibility to true initially for default basemap
            });

            const carbonLayer = new ol.layer.Tile({
                source: new ol.source.TileWMS({
                    url: "https://maps.isric.org/mapserv?map=/map/ocs.map&SERVICE=WMS&VERSION=1.3.0&REQUEST=GetMap&BBOX=-19948500.0,-6147449.0951699,19688885.757062882,8361000.0&CRS=EPSG:152160&WIDTH=1426&HEIGHT=895&LAYERS=ocs_0-30cm_mean&STYLES=&FORMAT=application/openlayers",
                }),
                visible: false // set visibility to false initially
            });



            //const soilLayer = new ol.layer.Tile({
            //  source: new ol.source.TileWMS({
            //    url: "https://data.opendevelopmentmekong.net/geoserver/ODVietnam/Soil%20map/wms",
            //  params: {
            //    'LAYERS': 'ODVietnam:Soil map',
            //},
            // projection: "EPSG:4326"
            //}),
            //visible: false // set visibility to false initially
            //});

            const phLayer = new ol.layer.Tile({
                source: new ol.source.TileWMS({
                    url: "https://maps.isric.org/mapserv?map=/map/phh2o.map",
                    params: { 'LAYERS': 'phh2o_0-5cm_mean' },
                    projection: "EPSG:152160"
                }),
                visible: false
            });


            const nitrogenLayer = new ol.layer.Tile({
                source: new ol.source.TileWMS({
                    url: "https://maps.isric.org/mapserv?map=/map/nitrogen.map",
                    params: { 'LAYERS': 'nitrogen_0-5cm_mean' },
                    projection: "EPSG:152160"
                }),
                visible: false
            });



            // Initialize the map
            const map = new ol.Map({
                target: mapElement,
                layers: [satelliteLayer, streetLayer, carbonLayer, phLayer, nitrogenLayer],
                view: new ol.View({
                    center: ol.proj.fromLonLat([106.6297, 10.8231]),
                    zoom: 15,
                }),
                controls: [],
            });

            let currentBasemap = 1;
            const basemaps = [streetLayer, satelliteLayer, carbonLayer, phLayer, nitrogenLayer];

            function selectBasemap(index) {
                if (!basemaps[index].getVisible()) {
                    basemaps.forEach((layer, i) => {
                        layer.setVisible(i === index);
                    });

                    currentBasemap = index;

                    const logoElement = document.querySelector(".logo");
                    const logoImage = basemaps[currentBasemap] === satelliteLayer
                        ? "https://i.ibb.co/J3YP1x4/enfarm-4.png"
                        : "https://i.ibb.co/LCK5s6V/en-Farm-logo-6-2x.png";
                    logoElement.src = logoImage;
                }

                const basemapImages = document.querySelectorAll(".image-container > div");
                basemapImages.forEach((image, i) => {
                    const circle = image.querySelector(".selected-basemap-circle");
                    image.classList.toggle("selected", i === index);
                    circle.style.display = i === index ? "block" : "none";
                });

                const basemapSelector = document.getElementById("basemapSelector");
                basemapSelector.style.transform = "translateX(-50%) translateY(0)";

                setTimeout(() => {
                    basemapSelector.style.display = "none";
                }, 500);
            }

            const basemapImages = document.querySelectorAll(".image-container > div");
            basemapImages.forEach((image, index) => {
                image.addEventListener("click", () => {
                    selectBasemap(index);
                });
            });

            const defaultBasemapImage = basemapImages[0];
            const defaultBasemapCircle = defaultBasemapImage.querySelector(".selected-basemap-circle");
            defaultBasemapCircle.style.display = "block";

            window.addEventListener("DOMContentLoaded", function () {
                const basemapSelector = document.getElementById("basemapSelector");
                basemapSelector.style.display = "none";
            });

            function closeBasemapSelector() {
                const basemapSelector = document.getElementById("basemapSelector");
                basemapSelector.style.transform = "translateX(-50%) translateY(100%)";
                setTimeout(() => {
                    basemapSelector.style.display = "none";
                }, 300);
            }


            //function to switching ISRIC legends based on ISRIC basemaps
            // Function to handle layer visibility change and display legend elements
            function handleLayerVisibilityChange(layer, legendClass, closeLegendClass, closeLegendIconClass) {
                const legendElement = document.querySelector(legendClass);
                const closeLegendElement = document.querySelector(closeLegendClass);
                const closeLegendIconElement = document.querySelector(closeLegendIconClass);

                return function () {
                    if (layer.getVisible()) {
                        legendElement.style.display = 'block';
                        closeLegendElement.style.display = 'block';
                        closeLegendIconElement.style.display = 'block';
                    } else {
                        legendElement.style.display = 'none';
                        closeLegendElement.style.display = 'none';
                        closeLegendIconElement.style.display = 'none';
                    }
                };
            }

            // When carbonLayer basemap is called
            carbonLayer.on('change:visible', handleLayerVisibilityChange(carbonLayer, '.carbonLegend', '.closecarbonLegend', '.closecarbonLegend i'));

            // When phLayer basemap is called
            phLayer.on('change:visible', handleLayerVisibilityChange(phLayer, '.phLegend', '.closepHLegend', '.closepHLegend i'));

            // When nitrogenLayer basemap is called
            nitrogenLayer.on('change:visible', handleLayerVisibilityChange(nitrogenLayer, '.nitrogenLegend', '.closenitrogenLegend', '.closenitrogenLegend i'));





            ///// BASEMAP ATTRIBUTION \\\\\
            function closeAttribution(attributionClass) {
                var attribution = document.querySelector(attributionClass);
                attribution.style.display = 'none';
            }

            function openAttribution(attributionClass) {
                var attribution = document.querySelector(attributionClass);
                attribution.style.display = 'block';
            }

            function stopBasemapSwitch(event) {
                event.stopPropagation();
            }

            const infoIcons = document.querySelectorAll(".info-icon, .osminfo-icon, .mapboxinfo-icon");
            infoIcons.forEach((infoIcon) => {
                let attributionClass;
                if (infoIcon.classList.contains("info-icon")) {
                    attributionClass = ".isric-attribution";
                } else if (infoIcon.classList.contains("osminfo-icon")) {
                    attributionClass = ".osm-attribution";
                } else if (infoIcon.classList.contains("mapboxinfo-icon")) {
                    attributionClass = ".mapbox-attribution";
                }
                infoIcon.addEventListener("click", () => openAttribution(attributionClass));
                infoIcon.addEventListener("click", stopBasemapSwitch);
            });









            ///// MEASURE AREA BUTTON FUNCTION \\\\\
            let drawArea;
            let measureAreaSource;
            let measureAreaTooltipElement;
            let measureAreaTooltip;
            let sketchArea;
            let lineTooltips = [];
            let floatingMessageAreaTimeoutId;

            function startMeasurementArea() {
                const measureAreaBtn = document.getElementById("measureAreaBtn");
                const measureAreaBtnIcon = measureAreaBtn.querySelector("i");

                if (measureAreaBtn.classList.contains("active")) {
                    // Disable measuring area
                    measureAreaBtn.classList.remove("active");
                    map.removeInteraction(drawArea);
                    map.removeOverlay(measureAreaTooltip);
                    measureAreaTooltipElement = null;
                    measureAreaSource.clear();
                    clearLineTooltips(); // Clear length tooltips

                    // Change the icon back to the "square_foot" icon
                    measureAreaBtnIcon.textContent = "square_foot";
                    // Reset the background color to white
                    measureAreaBtn.style.backgroundColor = "#ffffff";
                    // Change the icon color to black
                    measureAreaBtnIcon.style.color = "#515151";

                    // Clear timeout and hide the floating message immediately
                    clearTimeout(floatingMessageAreaTimeoutId);
                    const floatingMessage = document.getElementById("floatingMessageArea");
                    if (floatingMessage && floatingMessage.parentNode) {
                        floatingMessage.parentNode.removeChild(floatingMessage);
                    }

                    // Hide the finish drawing button
                    const finishDrawingButton = document.getElementById("finishDrawingButton");
                    if (finishDrawingButton) {
                        finishDrawingButton.classList.add("hidden");
                    }
                } else {
                    // Enable measuring area
                    measureAreaBtn.classList.add("active");
                    measureAreaSource = new ol.source.Vector();
                    map.addLayer(
                        new ol.layer.Vector({
                            source: measureAreaSource,
                            style: new ol.style.Style({
                                fill: new ol.style.Fill({
                                    color: "rgba(247, 200, 21, 0.8)", // 80% transparent fill
                                }),
                                stroke: new ol.style.Stroke({
                                    color: "#F7C815",
                                    width: 10,
                                }),
                                image: new ol.style.Circle({
                                    radius: 7,
                                    fill: new ol.style.Fill({
                                        color: "#F7C815",
                                    }),
                                }),
                            }),
                        })
                    );
                    createMeasureAreaTooltip();
                    addAreaInteraction();

                    // Change the icon to the "close" icon
                    measureAreaBtnIcon.textContent = "close";
                    // Change the background color to dark red
                    measureAreaBtn.style.backgroundColor = "#FF6666";
                    // Change the icon color to white
                    measureAreaBtnIcon.style.color = "#ffffff";

                    // Add floating message
                    const floatingMessage = document.createElement("div");
                    floatingMessage.className = "floating-message";
                    floatingMessage.id = "floatingMessageArea";
                    const infoIcon = document.createElement("i");
                    infoIcon.className = "material-icons";
                    infoIcon.textContent = "touch_app";
                    infoIcon.style.fontSize = "100px";
                    floatingMessage.appendChild(infoIcon);
                    floatingMessage.innerHTML += "  Chạm vào màn hình để bắt đầu đo"; // "Tap the screen to start measuring"
                    map.getViewport().appendChild(floatingMessage);

                    // Remove floating message after 05 seconds
                    floatingMessageAreaTimeoutId = setTimeout(function () {
                        map.getViewport().removeChild(floatingMessage);
                    }, 5000);
                }
            }

            let drawAreaStartListener;
            let drawAreaEndListener;

            function addAreaInteraction() {
                drawArea = new ol.interaction.Draw({
                    source: measureAreaSource,
                    type: "Polygon",
                    style: new ol.style.Style({
                        fill: new ol.style.Fill({
                            color: "rgba(255, 255, 255, 0.2)",
                        }),
                        stroke: new ol.style.Stroke({
                            color: "#F7C815",
                            width: 10,
                        }),
                        image: new ol.style.Circle({
                            radius: 18,
                            fill: new ol.style.Fill({
                                color: "#F7C815",
                            }),
                            stroke: new ol.style.Stroke({
                                color: "#ffffff",
                                width: 9,
                            }),
                        }),
                    }),
                });
                map.addInteraction(drawArea);

                // Declare a variable to count how many points have been clicked
                let clickCount = 0;

                drawAreaStartListener = drawArea.on("drawstart", function (evt) {
                    const feature = evt.feature;
                    sketchArea = feature;
                    createHelpAreaTooltip();
                    map.on("pointermove", pointerMoveHandler);

                    // Reset click count
                    clickCount = 0;

                    // Add a vertex listener to count clicks
                    feature.getGeometry().on("change", function (event) {
                        clickCount++;

                        // Check if the user has clicked 3 times
                        if (clickCount === 3) {
                            // Show the finish button
                            const finishDrawingButton = document.getElementById("finishDrawingButton");
                            if (finishDrawingButton) {
                                finishDrawingButton.classList.remove("hidden");
                            }
                        }
                    });
                });

                document.getElementById('finishDrawingButton').addEventListener('click', function () {
                    drawArea.finishDrawing();
                });



                drawAreaEndListener = drawArea.on("drawend", function (evt) {
                    const feature = evt.feature;
                    measureAreaSource.removeFeature(sketchArea);
                    sketchArea = null;
                    measureAreaTooltipElement.className = "ol-tooltip ol-tooltip-static";
                    measureAreaTooltip.setOffset([0, -7]);

                    const geom = feature.getGeometry();
                    const extent = geom.getExtent();
                    const center = ol.extent.getCenter(extent);
                    const area = getArea(geom);

                    let measurement;
                    let measurementUnit;

                    if (area > 1000) {
                        measurement = (area / 10000).toFixed(2); // Convert to hectares (ha)
                        measurementUnit = "ha";
                    } else {
                        measurement = area.toFixed(2);
                        measurementUnit = "m²";
                    }

                    measureAreaTooltipElement.innerHTML = `<div style="display: flex; align-items: center;"><i class="material-icons" style="margin-right: 10px;"></i><span>Khu vực:</span><strong style="margin-left: 10px;">${measurement}${measurementUnit}</strong></div>`;


                    // Hide the finish button
                    const finishDrawingButton = document.getElementById("finishDrawingButton");
                    if (finishDrawingButton) {
                        finishDrawingButton.classList.add("hidden");
                    }


                    // Add a white background to the measurement size label
                    measureAreaTooltipElement.style.backgroundColor = "#ffffff";
                    measureAreaTooltipElement.style.padding = "10px 20px";
                    measureAreaTooltipElement.style.borderRadius = "50px";
                    measureAreaTooltipElement.style.boxShadow = "0 2px 4px rgba(0, 0, 0, 0.4)";
                    measureAreaTooltipElement.style.color = "#515151";
                    measureAreaTooltipElement.style.fontFamily = "Segoe UI";
                    measureAreaTooltipElement.style.fontSize = "35px";

                    // Position the measurement tooltip element in the middle of the map
                    measureAreaTooltip.setPosition(center);

                    // Create tooltips for each edge of the polygon
                    const coordinates = geom.getCoordinates()[0];
                    const numEdges = coordinates.length;
                    clearLineTooltips();
                    for (let i = 0; i < numEdges - 1; i++) {
                        const start = coordinates[i];
                        const end = coordinates[i + 1];
                        const midpoint = [(start[0] + end[0]) / 2, (start[1] + end[1]) / 2];
                        const length = ol.sphere.getLength(new ol.geom.LineString([start, end]));

                        const lineTooltip = createLineTooltip(length, midpoint, start, end);
                        lineTooltips.push(lineTooltip);
                        map.addOverlay(lineTooltip);
                    }

                    map.removeInteraction(drawArea);
                    map.un("pointermove", pointerMoveHandler);
                });

                drawAreaStartListener = drawArea.on("drawstart", function (evt) {
                    const feature = evt.feature;
                    sketchArea = feature;
                    createHelpAreaTooltip();
                    map.on("pointermove", pointerMoveHandler);
                });
            }

            let helpMeasureAreaTooltipElement;
            let helpMeasureAreaTooltip;

            function createHelpAreaTooltip() {
                if (helpMeasureAreaTooltipElement) {
                    helpMeasureAreaTooltipElement.parentNode.removeChild(helpMeasureAreaTooltipElement);
                }
                helpMeasureAreaTooltipElement = document.createElement("div");
                helpMeasureAreaTooltipElement.className = "ol-tooltip hidden";
                helpMeasureAreaTooltip = new ol.Overlay({
                    element: helpMeasureAreaTooltipElement,
                    offset: [15, 0],
                    positioning: "center-left",
                });
                map.addOverlay(helpMeasureAreaTooltip);
            }

            function createMeasureAreaTooltip() {
                if (measureAreaTooltipElement) {
                    measureAreaTooltipElement.parentNode.removeChild(measureAreaTooltipElement);
                }
                measureAreaTooltipElement = document.createElement("div");
                measureAreaTooltipElement.className = "ol-tooltip ol-tooltip-measure";
                measureAreaTooltip = new ol.Overlay({
                    element: measureAreaTooltipElement,
                    offset: [100, 0],
                    positioning: "bottom-center",
                });
                map.addOverlay(measureAreaTooltip);
            }

            const continuePolygonMsg = "Click to continue drawing the polygon";

            function pointerMoveHandler(evt) {
                if (evt.dragging) {
                    return;
                }
                let helpMsg = "Click to continue drawing the polygon";
                if (sketchArea) {
                    const geom = sketchArea.getGeometry();
                    if (geom instanceof ol.geom.Polygon) {
                        helpMsg = continuePolygonMsg;
                    }
                }
            }


            function getArea(polygon) {
                const area = polygon.getArea();
                return area;
            }

            function createLineTooltip(length, midpoint, start, end) {
                const lineTooltipElement = document.createElement("div");
                lineTooltipElement.className = "ol-tooltip ol-tooltip-line";

                let measurement;
                let measurementUnit;

                if (length > 1000) {
                    measurement = (length / 1000).toFixed(2); // Convert to kilometers
                    measurementUnit = "km";
                } else {
                    measurement = length.toFixed(2);
                    measurementUnit = "m";
                }

                lineTooltipElement.innerHTML = `Chiều dài: ${measurement}${measurementUnit}`;

                // Add a white background to the line tooltip
                lineTooltipElement.style.backgroundColor = "#ffffff";
                lineTooltipElement.style.padding = "10px 20px";
                lineTooltipElement.style.borderRadius = "40px";
                lineTooltipElement.style.boxShadow = "0 2px 4px rgba(0, 0, 0, 0.4)";

                // Change the font color to Segoe UI (#515151) and set the font size to 12px
                lineTooltipElement.style.color = "#515151";
                lineTooltipElement.style.fontFamily = "Segoe UI";
                lineTooltipElement.style.fontSize = "28px";

                const lineTooltip = new ol.Overlay({
                    element: lineTooltipElement,
                    offset: [0, 0],
                    position: midpoint,
                    positioning: "center-center",
                });

                lineTooltipElement.addEventListener("mouseover", function () {
                    lineTooltip.setPosition(midpoint);
                });

                lineTooltipElement.addEventListener("mouseout", function () {
                    lineTooltip.setPosition(midpoint);
                });

                lineTooltipElement.addEventListener("click", function () {
                    const lineCoordinates = [start, end];
                    const lineString = new ol.geom.LineString(lineCoordinates);
                    const lineFeature = new ol.Feature(lineString);
                    measureAreaSource.addFeature(lineFeature);
                    lineTooltips.push(createLineTooltip(length, midpoint, start, end));
                    map.addOverlay(lineTooltips[lineTooltips.length - 1]);
                });

                return lineTooltip;
            }

            function clearLineTooltips() {
                lineTooltips.forEach(function (tooltip) {
                    map.removeOverlay(tooltip);
                });
                lineTooltips = [];
            }

            // Function to clear length tooltips
            function clearLengthTooltips() {
                clearLineTooltips();
            }


            // Handle clicks on the measureLengthBtn and sketchFarmBtn buttons
            document.getElementById("measureLengthBtn").addEventListener("click", deactivateMeasurementArea);
            document.getElementById("sketchFarmBtn").addEventListener("click", deactivateMeasurementArea);
            document.getElementById("addSensorBtn").addEventListener("click", deactivateMeasurementArea);

            function deactivateMeasurementArea() {
                const measureAreaBtn = document.getElementById("measureAreaBtn");
                if (measureAreaBtn.classList.contains("active")) {
                    // Set measureAreaBtn to inactive state
                    measureAreaBtn.classList.remove("active");

                    // Change the icon back to the "square_foot" icon
                    const measureAreaBtnIcon = measureAreaBtn.querySelector("i");
                    measureAreaBtnIcon.textContent = "square_foot";

                    // Reset the background color to white
                    measureAreaBtn.style.backgroundColor = "#ffffff";

                    // Change the icon color to black
                    measureAreaBtnIcon.style.color = "#515151";

                    // Remove interactions
                    if (drawArea) {
                        map.removeInteraction(drawArea);
                        drawArea = null;
                    }

                    // Remove listeners
                    if (drawAreaStartListener) {
                        ol.Observable.unByKey(drawAreaStartListener);
                        drawAreaStartListener = null;
                    }
                    if (drawAreaEndListener) {
                        ol.Observable.unByKey(drawAreaEndListener);
                        drawAreaEndListener = null;
                    }

                    // Clear timeout and hide the floating message immediately
                    clearTimeout(floatingMessageAreaTimeoutId);
                    const floatingMessage = document.getElementById("floatingMessageArea");
                    if (floatingMessage && floatingMessage.parentNode) {
                        floatingMessage.parentNode.removeChild(floatingMessage);
                    }

                    // Hide the finish drawing button
                    const finishDrawingButton = document.getElementById("finishDrawingButton");
                    if (finishDrawingButton) {
                        finishDrawingButton.classList.add("hidden");
                    }

                    // Note: We are not clearing the source or removing the overlay, so the drawn polygons and tooltips should remain visible.
                }
            }




            ///// MEASURE LENGTH BUTTON FUNCTION \\\\\
            let drawLength;
            let measureLengthSource;
            let measureLengthTooltipElement;
            let measureLengthTooltip;
            let sketchLength;
            let floatingMessageTimeoutId;

            function startMeasurementLength() {
                const measureLengthBtn = document.getElementById("measureLengthBtn");
                const measureLengthBtnIcon = measureLengthBtn.querySelector("i");

                if (measureLengthBtn.classList.contains("active")) {
                    // Disable measuring length
                    measureLengthBtn.classList.remove("active");
                    map.removeInteraction(drawLength);
                    map.removeOverlay(measureLengthTooltip);
                    measureLengthTooltipElement = null;
                    measureLengthSource.clear();

                    // Change the icon back to the "straighten" icon
                    measureLengthBtnIcon.textContent = "straighten";
                    // Reset the background color to white
                    measureLengthBtn.style.backgroundColor = "#ffffff";
                    // Change the icon color to black
                    measureLengthBtnIcon.style.color = "#515151";

                    // Hide the finish button
                    const finishDrawingButton = document.getElementById("finishDrawingButton");
                    if (finishDrawingButton) {
                        finishDrawingButton.classList.add("hidden");
                    }

                    // Clear timeout and hide the floating message immediately
                    clearTimeout(floatingMessageTimeoutId);
                    const floatingMessage = document.getElementById("floatingMessage");
                    if (floatingMessage && floatingMessage.parentNode) {
                        floatingMessage.parentNode.removeChild(floatingMessage);
                    }


                } else {
                    // Enable measuring length
                    measureLengthBtn.classList.add("active");
                    measureLengthSource = new ol.source.Vector();
                    map.addLayer(
                        new ol.layer.Vector({
                            source: measureLengthSource,
                            style: new ol.style.Style({
                                stroke: new ol.style.Stroke({
                                    color: "#386c34",
                                    width: 8,
                                }),
                            }),
                        })
                    );
                    createMeasureLengthTooltip();
                    addLengthInteraction();

                    // Change the icon to the "close" icon
                    measureLengthBtnIcon.textContent = "close";
                    // Change the background color to dark red
                    measureLengthBtn.style.backgroundColor = "#FF6666";
                    // Change the icon color to white
                    measureLengthBtnIcon.style.color = "#ffffff";

                    // Add floating message
                    const floatingMessage = document.createElement("div");
                    floatingMessage.className = "floating-message";
                    floatingMessage.id = "floatingMessage"; // Assign an ID to the floating message element
                    const infoIcon = document.createElement("i");
                    infoIcon.className = "material-icons";
                    infoIcon.textContent = "touch_app";
                    infoIcon.style.fontSize = "100px";
                    floatingMessage.appendChild(infoIcon);
                    floatingMessage.innerHTML += "  Chạm vào màn hình để bắt đầu đo"; //"Tap the screen to start measuring"
                    map.getViewport().appendChild(floatingMessage);

                    setTimeout(function () {
                        if (floatingMessage.parentNode === map.getViewport()) {
                            map.getViewport().removeChild(floatingMessage);
                        }
                    }, 5000);


                }
            }

            let drawLengthStartListener;
            let drawLengthEndListener;

            function addLengthInteraction() {
                drawLength = new ol.interaction.Draw({
                    source: measureLengthSource,
                    type: "LineString",
                    style: new ol.style.Style({
                        stroke: new ol.style.Stroke({
                            color: "#386c34",
                            width: 8,
                        }),
                        image: new ol.style.Circle({
                            radius: 18,
                            fill: new ol.style.Fill({
                                color: "#386c34",
                            }),
                            stroke: new ol.style.Stroke({
                                color: "#ffffff",
                                width: 9,
                            }),
                        }),
                    }),
                });
                map.addInteraction(drawLength);

                // Declare a variable to count how many points have been clicked
                let clickCount = 0;

                drawLength.on("drawstart", function (evt) {
                    const feature = evt.feature;
                    sketchLength = feature;

                    // Reset click count
                    clickCount = 0;

                    // Add a vertex listener to count clicks
                    feature.getGeometry().on("change", function (event) {
                        clickCount++;

                        // Check if the user has clicked 2 times
                        if (clickCount === 2) {
                            // Show the finish button
                            const finishDrawingButton = document.getElementById("finishDrawingButton");
                            if (finishDrawingButton) {
                                finishDrawingButton.classList.remove("hidden");
                            }
                        }
                    });
                });
                // Add event listener to the finish button
                document.getElementById('finishDrawingButton').addEventListener('click', function () {
                    drawLength.finishDrawing();
                });

                drawLengthEndListener = drawLength.on("drawend", function (evt) {
                    const feature = evt.feature;
                    measureLengthSource.removeFeature(sketchLength);
                    sketchLength = null;
                    measureLengthTooltipElement.className = "ol-tooltip ol-tooltip-static";
                    measureLengthTooltip.setOffset([0, -7]);

                    const geom = feature.getGeometry();
                    const length = getLength(geom);

                    let measurement = length.toFixed(2);
                    let measurementUnit = "m";

                    if (length > 1000) {
                        measurement = (length / 1000).toFixed(2); // Convert to kilometers
                        measurementUnit = "km";
                    }

                    measureLengthTooltipElement.innerHTML = `Độ dài: <strong>${measurement}</strong>${measurementUnit}`;


                    // Add a white background to the measurement size label
                    measureLengthTooltipElement.style.backgroundColor = "#ffffff";
                    measureLengthTooltipElement.style.padding = "10px 30px";
                    measureLengthTooltipElement.style.borderRadius = "40px";
                    measureLengthTooltipElement.style.boxShadow = "0 2px 4px rgba(0, 0, 0, 0.4)";


                    // Change the font color to Segoe UI (#515151) and set the font size to 35px
                    measureLengthTooltipElement.style.color = "#515151";
                    measureLengthTooltipElement.style.fontFamily = "Segoe UI";
                    measureLengthTooltipElement.style.fontSize = "35px";

                    // Position the measurement tooltip element in the middle of the map
                    measureLengthTooltip.setPosition(geom.getLastCoordinate());

                    map.removeInteraction(drawLength);
                    map.un("pointermove", pointerMoveHandler);

                    // Hide the finish button
                    const finishDrawingButton = document.getElementById("finishDrawingButton");
                    if (finishDrawingButton) {
                        finishDrawingButton.classList.add("hidden");
                    }
                });
            }

            let helpMeasureLengthTooltipElement;
            let helpMeasureLengthTooltip;

            function createHelpLengthTooltip() {
                if (helpMeasureLengthTooltipElement) {
                    helpMeasureLengthTooltipElement.parentNode.removeChild(helpMeasureLengthTooltipElement);
                }
                helpMeasureLengthTooltipElement = document.createElement("div");
                helpMeasureLengthTooltipElement.className = "ol-tooltip hidden";
                helpMeasureLengthTooltip = new ol.Overlay({
                    element: helpMeasureLengthTooltipElement,
                    offset: [15, 0],
                    positioning: "center-left",
                });
                map.addOverlay(helpMeasureLengthTooltip);
            }

            function createMeasureLengthTooltip() {
                if (measureLengthTooltipElement) {
                    measureLengthTooltipElement.parentNode.removeChild(measureLengthTooltipElement);
                }
                measureLengthTooltipElement = document.createElement("div");
                measureLengthTooltipElement.className = "ol-tooltip ol-tooltip-measure";
                measureLengthTooltip = new ol.Overlay({
                    element: measureLengthTooltipElement,
                    offset: [0, -15],
                    positioning: "bottom-center",
                });
                map.addOverlay(measureLengthTooltip);
            }

            //function pointerMoveHandler(evt) {
            //if (evt.dragging) {
            //  return;
            //}
            //const helpMsg = "Tap to continue drawing the line";
            //if (sketchLength) {
            //const geom = sketchLength.getGeometry();
            //if (geom instanceof ol.geom.LineString) {
            //    helpMsg = continueLineMsg;
            //  }
            //}
            //helpMeasureLengthTooltipElement.innerHTML = helpMsg;
            //helpMeasureLengthTooltip.setPosition(evt.coordinate);
            //helpMeasureLengthTooltipElement.classList.remove("hidden");
            //}

            function getLength(line) {
                const length = line.getLength();
                return length;
            }


            function deactivateMeasurementLength() {
                const measureLengthBtn = document.getElementById("measureLengthBtn");
                if (measureLengthBtn.classList.contains("active")) {
                    // Set measureLengthBtn to inactive state
                    measureLengthBtn.classList.remove("active");

                    // Change the icon back to the "straighten" icon
                    const measureLengthBtnIcon = measureLengthBtn.querySelector("i");
                    measureLengthBtnIcon.textContent = "straighten";

                    // Reset the background color to white
                    measureLengthBtn.style.backgroundColor = "#ffffff";

                    // Change the icon color to black
                    measureLengthBtnIcon.style.color = "#515151";

                    // Remove interactions
                    if (drawLength) {
                        map.removeInteraction(drawLength);
                        drawLength = null;
                    }

                    // Remove listeners
                    if (drawLengthStartListener) {
                        ol.Observable.unByKey(drawLengthStartListener);
                        drawLengthStartListener = null;
                    }
                    if (drawLengthEndListener) {
                        ol.Observable.unByKey(drawLengthEndListener);
                        drawLengthEndListener = null;
                    }

                    // Clear timeout and hide the floating message immediately
                    clearTimeout(floatingMessageTimeoutId);
                    const floatingMessage = document.getElementById("floatingMessage");
                    if (floatingMessage && floatingMessage.parentNode) {
                        floatingMessage.parentNode.removeChild(floatingMessage);
                    }

                    // Note: We are not clearing the source or removing the overlay, so the drawn lines and tooltips should remain visible.
                }
            }

            document.getElementById("measureAreaBtn").addEventListener("click", deactivateMeasurementLength);
            document.getElementById("sketchFarmBtn").addEventListener("click", deactivateMeasurementLength);
            document.getElementById("addSensorBtn").addEventListener("click", deactivateMeasurementLength);


            ///// SKETCH FARM BUTTON FUNCTION \\\\\
            // Function to fetch place name from OSM Nominatim
            async function fetchPlaceName(lon, lat) {
                const baseUrl = "https://nominatim.openstreetmap.org/reverse";
                const format = "json";
                const url = `${baseUrl}?lon=${lon}&lat=${lat}&format=${format}&zoom=18&addressdetails=1`;

                try {
                    const response = await fetch(url);
                    if (response.ok) {
                        const data = await response.json();
                        const placeName = data.display_name || "";
                        return placeName;
                    } else {
                        console.error(
                            "Failed to fetch place name:",
                            response.status,
                            response.statusText
                        );
                        return "";
                    }
                } catch (error) {
                    console.error("Failed to fetch place name:", error);
                    return "";
                }
            }

            let isSketchActive = false;
            let draw;
            let polygonExists = false;
            let vectorSource = new ol.source.Vector();
            let tooltipOverlay;
            let tooltipOverlays = [];
            let timeoutId = null;

            let sketchFarmBtnIcon;

            async function startSketchFarm() {
                const sketchFarmBtn = document.getElementById("sketchFarmBtn");
                sketchFarmBtnIcon = sketchFarmBtn.querySelector("i");
                const finishDrawingButton = document.querySelector('.finish-drawing');
                const dialog = document.getElementById('dialog');

                if (isSketchActive) {
                    if (timeoutId) {
                        clearTimeout(timeoutId);
                        const existingFloatingMessage = document.querySelector('.floating-message');
                        if (existingFloatingMessage) {
                            map.getViewport().removeChild(existingFloatingMessage);
                        }
                        timeoutId = null;
                    }

                    if (polygonExists) {
                        dialog.classList.remove('hidden');

                        document.getElementById('deleteYes').addEventListener('click', function () {
                            map.removeInteraction(draw);
                            isSketchActive = false;
                            polygonExists = false;
                            vectorSource.clear();
                            for (const overlay of tooltipOverlays) {
                                map.removeOverlay(overlay);
                            }
                            sketchFarmBtn.style.backgroundColor = "white";
                            sketchFarmBtnIcon.textContent = "create";
                            sketchFarmBtnIcon.style.color = "#515151";
                            finishDrawingButton.classList.add('hidden');
                            dialog.classList.add('hidden');

                            console.clear();

                            // Remove stored polygon from local storage
                            localStorage.removeItem('enfarm_polygon_coordinates');
                        });

                        document.getElementById('deleteNo').addEventListener('click', function () {
                            dialog.classList.add('hidden');
                        });
                    } else {
                        map.removeInteraction(draw);
                        isSketchActive = false;
                        sketchFarmBtn.style.backgroundColor = "white";
                        sketchFarmBtnIcon.textContent = "create";
                        sketchFarmBtnIcon.style.color = "#515151";
                        finishDrawingButton.classList.add('hidden');
                    }
                    return;
                }


                const floatingMessage = document.createElement("div");
                floatingMessage.className = "floating-message";
                const infoIcon = document.createElement("i");
                infoIcon.className = "material-icons";
                infoIcon.textContent = "touch_app";
                infoIcon.style.fontSize = "100px";
                floatingMessage.appendChild(infoIcon);
                floatingMessage.innerHTML +=
                    "   Chạm vào màn hình để bắt đầu vẽ trang trại"; // "Tap the screen to start drawing farm"
                map.getViewport().appendChild(floatingMessage);

                timeoutId = setTimeout(function () {
                    map.getViewport().removeChild(floatingMessage);
                }, 3000);

                const farmVectorLayer = new ol.layer.Vector({
                    source: vectorSource,
                    style: new ol.style.Style({
                        fill: new ol.style.Fill({
                            color: "rgba(56, 108, 52, 0.5)", // 80% transparent fill
                        }),
                        stroke: new ol.style.Stroke({
                            color: "#386c34", // solid color for the stroke
                            width: 10,
                        }),
                    }),
                });

                map.addLayer(farmVectorLayer);

                draw = new ol.interaction.Draw({
                    source: vectorSource,
                    type: "Polygon",
                    style: new ol.style.Style({
                        fill: new ol.style.Fill({
                            color: "rgba(255, 255, 255, 0.1)",
                        }),
                        stroke: new ol.style.Stroke({
                            color: "#386c34",
                            width: 10,
                        }),
                        image: new ol.style.Circle({
                            radius: 18,
                            fill: new ol.style.Fill({
                                color: "#386c34",
                            }),
                            stroke: new ol.style.Stroke({
                                color: "#ffffff",
                                width: 9,
                            }),
                        }),
                    }),
                });

                map.addInteraction(draw);
                isSketchActive = true;

                const canvas = document.createElement("canvas");
                const context = canvas.getContext("2d");
                const size = 10;
                const spacing = 8;
                canvas.width = size;
                canvas.height = size;
                context.strokeStyle = "rgba(56, 108, 52, 0.5)";
                context.lineWidth = 2;
                context.beginPath();
                context.moveTo(0, 0);
                context.lineTo(size, size);
                context.stroke();

                const pattern = context.createPattern(canvas, "repeat");

                farmVectorLayer.setStyle(
                    new ol.style.Style({
                        fill: new ol.style.Fill({
                            color: pattern,
                        }),
                        stroke: new ol.style.Stroke({
                            color: "#386c34",
                            width: 10,
                        }),
                    })
                );

                sketchFarmBtn.style.backgroundColor = "#FF6666";
                sketchFarmBtnIcon.textContent = "delete_forever";
                sketchFarmBtnIcon.style.color = "white";

                draw.on("drawstart", function (event) {
                    polygonExists = true;
                    event.feature.getGeometry().on("change", function (geomEvent) {
                        const coordinates = geomEvent.target.getCoordinates()[0];
                        if (coordinates.length >= 5) {
                            finishDrawingButton.classList.remove('hidden');
                        }
                    });
                });

                draw.on("drawend", async function (event) {
                    const polygonGeometry = event.feature.getGeometry();
                    const centroid = ol.extent.getCenter(polygonGeometry.getExtent());
                    const farmCenterLon = centroid[0];
                    const farmCenterLat = centroid[1];

                    const pointFeature = new ol.Feature({
                        geometry: new ol.geom.Point(centroid),
                    });

                    pointFeature.setStyle(
                        new ol.style.Style({
                            image: new ol.style.Circle({
                                radius: 16,
                                fill: new ol.style.Fill({
                                    color: '#386c34',
                                }),
                                stroke: new ol.style.Stroke({
                                    color: 'white',
                                    width: 8,
                                }),
                            }),
                        })
                    );

                    map.removeInteraction(draw);
                    isSketchActive = false;

                    sketchFarmBtn.style.backgroundColor = "white";
                    sketchFarmBtnIcon.textContent = "create";
                    sketchFarmBtnIcon.style.color = "#515151";

                    vectorSource.addFeature(pointFeature);

                    const centerPointCoordinates = ol.proj.transform([farmCenterLon, farmCenterLat], 'EPSG:3857', 'EPSG:4326');
                    console.log('Center Point Lon:', centerPointCoordinates[0]);
                    console.log('Center Point Lat:', centerPointCoordinates[1]);

                    const polygonCoordinates = polygonGeometry.getCoordinates()[0];
                    console.log('Polygon Coordinates:');
                    const polygonPoints = [];
                    polygonCoordinates.forEach((coordinate, index) => {
                        const lonLat = ol.proj.transform(coordinate, 'EPSG:3857', 'EPSG:4326');
                        polygonPoints.push({ lon: lonLat[0], lat: lonLat[1] });
                        console.log(`Corner Point ${index + 1}: Lon ${lonLat[0]}, Lat ${lonLat[1]}`);
                    });

                    const segments = [];
                    const segmentLengths = [];
                    for (let i = 0; i < polygonCoordinates.length - 1; i++) {
                        const startPoint = polygonCoordinates[i];
                        const endPoint = polygonCoordinates[i + 1];
                        const segment = new ol.geom.LineString([startPoint, endPoint]);
                        segments.push(segment);
                        const length = ol.sphere.getLength(segment);
                        segmentLengths.push(length.toFixed(2));
                    }

                    console.log('Segment Lengths (m):');
                    segmentLengths.forEach((length, index) => {
                        console.log(`Segment ${index + 1}: ${length} meters`);
                    });

                    const area = ol.sphere.getArea(polygonGeometry);
                    let areaHectares = null;
                    if (area > 10000) {
                        areaHectares = (area / 10000).toFixed(2);
                    }
                    console.log('Polygon Area:');
                    console.log(`Area (m²): ${area.toFixed(2)} square meters`);
                    if (areaHectares) {
                        console.log(`Area (ha): ${areaHectares} hectares`);
                    }

                    const address = await fetchPlaceName(centerPointCoordinates[0], centerPointCoordinates[1]);
                    console.log("Address:", address);

                    const tooltipElement = document.createElement('div');
                    tooltipElement.style.cssText = `
position: absolute;
background-color: #ffffff;
border: 1px solid #ccc;
border-radius: 1000px;
padding: 20px 30px;
font-family: 'Be Vietnam Pro', Arial, sans-serif;
font-size: 40px;
font-weight: bold;
color: #000000;
box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
display: flex;
align-items: center;
justify-content: center;
min-width: 120px;
height: 30px;
`;

                    const areaInHectares = area > 10000 ? (area / 10000).toFixed(2) + ' ha' : area.toFixed(2) + ' m²';
                    tooltipElement.innerHTML = `<span style="white-space: nowrap; display: flex; align-items: center; color: #515151;"><i class="material-icons" style="font-size: 50px; margin-right: 10px;">agriculture</i>${areaInHectares}</span>`;

                    tooltipOverlay = new ol.Overlay({
                        element: tooltipElement,
                        offset: [0, -120],
                        positioning: 'bottom-center',
                    });

                    tooltipOverlay.setPosition(centroid);

                    map.addOverlay(tooltipOverlay);
                    tooltipOverlays.push(tooltipOverlay);

                    //Get Elevation Values from Map Box Elevation
                    async function getElevationFromMapbox(centerPointCoordinates) {
                        const accessToken = 'pk.eyJ1IjoiY21sb3NhcmlhIiwiYSI6ImNsZGJ4cHp2ajAwMGszb3FmeXpxYmVpMHkifQ.3wsPFc9FkszxcH27eEq2dw';

                        let centerElevation;

                        try {
                            const centerPointLon = centerPointCoordinates[0];
                            const centerPointLat = centerPointCoordinates[1];
                            const centerUrl = `https://api.mapbox.com/v4/mapbox.mapbox-terrain-v2/tilequery/${centerPointLon},${centerPointLat}.json?layers=contour&access_token=${accessToken}`;
                            const centerResponse = await fetch(centerUrl);
                            if (centerResponse.ok) {
                                const centerData = await centerResponse.json();
                                if (centerData.features && centerData.features.length > 0) {
                                    centerElevation = centerData.features[0].properties.ele; // Update the assignment statement
                                    console.log("Elevation (meters):", centerElevation);
                                } else {
                                    console.error("No elevation data found for the center point.");
                                }
                            } else {
                                console.error("Failed to fetch elevation data for the center point:", centerResponse.status, centerResponse.statusText);
                            }
                        } catch (error) {
                            console.error("Failed to fetch elevation data for the center point:", error);
                        }

                        // Send to React Native App
                        const dataToPost = {
                            centerPoint: {
                                lon: centerPointCoordinates[0],
                                lat: centerPointCoordinates[1],
                                elevation: centerElevation
                            },
                            polygonCoordinates: polygonPoints,
                            segmentLengths: segmentLengths,
                            area: {
                                squareMeters: area.toFixed(2),
                                hectares: areaHectares
                            },
                            address: address
                        };

                        try {
                            // Send data to React Native App
                            window.ReactNativeWebView.postMessage(JSON.stringify(dataToPost));
                        } catch (error) {
                            // Handle the error (or do nothing to prevent logging)
                        }
                    }

                    // Usage example:
                    // Assuming you have the centerPointCoordinates from your existing code
                    getElevationFromMapbox(centerPointCoordinates);


                    // Store polygon coordinates in local storage
                    const storedPolygon = {
                        centerPoint: {
                            lon: centerPointCoordinates[0],
                            lat: centerPointCoordinates[1],
                        },
                        polygonPoints: polygonPoints,
                        segmentLengths: segmentLengths,
                        area: {
                            squareMeters: area.toFixed(2),
                            hectares: areaHectares
                        },
                        address: address
                    };
                    localStorage.setItem('enfarm_polygon_coordinates', JSON.stringify(storedPolygon));
                });
            }

            const sketchFarmBtn = document.getElementById("sketchFarmBtn");
            sketchFarmBtn.addEventListener("click", function () {
                startSketchFarm();
            });

            const finishDrawingButton = document.querySelector('.finish-drawing');
            finishDrawingButton.onclick = function () {
                if (draw) {
                    draw.finishDrawing();
                    finishDrawingButton.classList.add('hidden');
                    map.removeInteraction(draw);
                    isSketchActive = false;
                    sketchFarmBtn.style.backgroundColor = "white";
                    sketchFarmBtnIcon.textContent = "create";
                    sketchFarmBtnIcon.style.color = "#515151";
                }
            };

            function deactivateSketchFarm() {
                const sketchFarmBtn = document.getElementById("sketchFarmBtn");
                if (isSketchActive) {
                    sketchFarmBtn.style.backgroundColor = "white";
                    const sketchFarmBtnIcon = sketchFarmBtn.querySelector("i");
                    sketchFarmBtnIcon.textContent = "create";
                    sketchFarmBtnIcon.style.color = "#515151";

                    if (draw) {
                        map.removeInteraction(draw);
                        draw = null;
                    }

                    if (timeoutId) {
                        clearTimeout(timeoutId);
                        timeoutId = null;
                    }

                    isSketchActive = false;
                }
            }

            document.getElementById("measureAreaBtn").addEventListener("click", deactivateSketchFarm);
            document.getElementById("measureLengthBtn").addEventListener("click", deactivateSketchFarm);
            document.getElementById("addSensorBtn").addEventListener("click", deactivateSketchFarm);

            let farmVectorLayer; // Declare the farmVectorLayer variable outside the function

            // Function to retrieve stored polygon from local storage
            function getStoredPolygon() {
                const storedPolygonString = localStorage.getItem('enfarm_polygon_coordinates');
                if (storedPolygonString) {
                    const storedPolygon = JSON.parse(storedPolygonString);
                    const polygonPoints = storedPolygon.polygonPoints.map(point => ol.proj.transform([point.lon, point.lat], 'EPSG:4326', 'EPSG:3857'));

                    const polygonFeature = new ol.Feature({
                        geometry: new ol.geom.Polygon([polygonPoints]),
                    });

                    const farmCenter = ol.proj.transform([storedPolygon.centerPoint.lon, storedPolygon.centerPoint.lat], 'EPSG:4326', 'EPSG:3857');

                    const farmCenterFeature = new ol.Feature({
                        geometry: new ol.geom.Point(farmCenter),
                    });

                    farmVectorLayer = new ol.layer.Vector({
                        source: new ol.source.Vector({
                            features: [polygonFeature, farmCenterFeature],
                        }),
                        style: [
                            new ol.style.Style({
                                fill: new ol.style.Fill({
                                    color: 'rgba(56, 108, 52, 0.5)',
                                }),
                                stroke: new ol.style.Stroke({
                                    color: '#386c34',
                                    width: 10,
                                }),
                            }),
                            new ol.style.Style({
                                image: new ol.style.Circle({
                                    radius: 16,
                                    fill: new ol.style.Fill({
                                        color: '#386c34',
                                    }),
                                    stroke: new ol.style.Stroke({
                                        color: 'white',
                                        width: 8,
                                    }),
                                }),
                                geometry: farmCenterFeature.getGeometry(),
                            }),
                        ],
                    });

                    vectorSource.addFeatures([polygonFeature, farmCenterFeature]); // Add both features to the vector source

                    map.addLayer(farmVectorLayer);

                    // Retrieve and display the farm's center point
                    const farmCenterLon = storedPolygon.centerPoint.lon;
                    const farmCenterLat = storedPolygon.centerPoint.lat;
                    console.log('Farm Center Lon:', farmCenterLon);
                    console.log('Farm Center Lat:', farmCenterLat);

                    const centroid = ol.extent.getCenter(polygonFeature.getGeometry().getExtent());

                    const tooltipElement = document.createElement('div');
                    tooltipElement.style.cssText = `
      position: absolute;
      background-color: #ffffff;
      border: 1px solid #ccc;
      border-radius: 1000px;
      padding: 20px 30px;
      font-family: 'Be Vietnam Pro', Arial, sans-serif;
      font-size: 40px;
      font-weight: bold;
      color: #000000;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      display: flex;
      align-items: center;
      justify-content: center;
      min-width: 120px;
      height: 30px;
    `;

                    const area = Number(storedPolygon.area.squareMeters); // Convert area to a number
                    const areaDisplay = area >= 10000 ? (area / 10000).toFixed(2) + 'ha' : area.toFixed(2) + 'm²';

                    tooltipElement.innerHTML = `<span style="white-space: nowrap; display: flex; align-items: center; color: #515151;"><i class="material-icons" style="font-size: 50px; margin-right: 10px;">agriculture</i>${areaDisplay}</span>`;

                    const tooltipOverlay = new ol.Overlay({
                        element: tooltipElement,
                        offset: [0, -120],
                        positioning: 'bottom-center',
                    });

                    tooltipOverlay.setPosition(centroid);

                    map.addOverlay(tooltipOverlay);
                    tooltipOverlays.push(tooltipOverlay);
                }
            }




            // Call the function to retrieve and display the stored polygon
            getStoredPolygon();

            // Update the finishDrawingButton click event to store the polygon in local storage
            finishDrawingButton.onclick = function () {
                if (draw) {
                    draw.finishDrawing();
                    finishDrawingButton.classList.add('hidden');
                    map.removeInteraction(draw);
                    isSketchActive = false;
                    sketchFarmBtn.style.backgroundColor = 'white';
                    sketchFarmBtnIcon.textContent = 'create';
                    sketchFarmBtnIcon.style.color = '#515151';

                    // Store polygon coordinates in local storage
                    const polygonCoordinates = vectorSource.getFeatures()[0].getGeometry().getCoordinates()[0];
                    const polygonPoints = polygonCoordinates.map(coordinate => {
                        const lonLat = ol.proj.transform(coordinate, 'EPSG:3857', 'EPSG:4326');
                        return { lon: lonLat[0], lat: lonLat[1] };
                    });

                    const storedPolygon = {
                        centerPoint: {
                            lon: centerPointCoordinates[0],
                            lat: centerPointCoordinates[1],
                        },
                        polygonPoints: polygonPoints,
                        segmentLengths: segmentLengths,
                        area: {
                            squareMeters: area.toFixed(2),
                            hectares: areaHectares,
                        },
                        address: address,
                    };
                    localStorage.setItem('enfarm_polygon_coordinates', JSON.stringify(storedPolygon));
                }
            };

            // Remove the stored polygon from local storage when the page loads
            window.addEventListener('load', function () {
                if (!localStorage.getItem('enfarm_polygon_coordinates')) {
                    if (farmVectorLayer) { // Add a check before removing the farmVectorLayer
                        map.removeLayer(farmVectorLayer);
                        farmVectorLayer = null;
                    }
                    for (const overlay of tooltipOverlays) {
                        map.removeOverlay(overlay);
                    }
                    tooltipOverlays = [];
                }
            });






            ///// ADD SENSORS BUTTON \\\\\

            let sensorDrawCount = 0;
            let sensorPointStyle = new ol.style.Style({
                image: new ol.style.Icon({
                    src: 'https://i.ibb.co/gWyRjHP/icons8-pin-96-xxhdpi.png',
                    anchor: [0.5, 1],
                    scale: 0.75,
                    rotateWithView: true,
                }),
            });

            let startAddSensorActive = false;
            let sensorDrawInteraction;
            let sensorVectorLayer;

            function startAddSensor() {
                let addSensorBtnIcon = document.querySelector(".addSensorBtn i");
                let addSensorBtn = document.querySelector(".addSensorBtn");

                addSensorBtnIcon.textContent = "delete_forever";
                addSensorBtn.style.backgroundColor = "#FF6666";
                addSensorBtnIcon.style.color = "white";

                const floatingMessage = document.createElement("div");
                floatingMessage.className = "floating-message";
                floatingMessage.id = "floatingMessageArea";
                const infoIcon = document.createElement("i");
                infoIcon.className = "material-icons";
                infoIcon.textContent = "touch_app";
                infoIcon.style.fontSize = "100px";
                floatingMessage.appendChild(infoIcon);
                floatingMessage.innerHTML += "  Nhấn vào màn hình để thêm/các cảm biến enfarm"; // "Tap the screen to add enfarm sensor/s"
                map.getViewport().appendChild(floatingMessage);

                const floatingMessageAreaTimeoutId = setTimeout(function () {
                    if (floatingMessage.parentNode === map.getViewport()) {
                        map.getViewport().removeChild(floatingMessage);
                    }
                }, 5000);

                const source = new ol.source.Vector();

                sensorVectorLayer = new ol.layer.Vector({
                    source: source,
                    style: sensorPointStyle,
                });

                map.addLayer(sensorVectorLayer);

                sensorDrawInteraction = new ol.interaction.Draw({
                    source: source,
                    type: 'Point',
                });

                map.addInteraction(sensorDrawInteraction);

                startAddSensorActive = true;

                sensorDrawInteraction.on('drawstart', function () {
                    sensorDrawCount = 0;
                });

                sensorDrawInteraction.on('drawend', function () {
                    const source = sensorVectorLayer.getSource();
                    const features = source.getFeatures();
                    if (features.length === 0) {
                        const finishDrawingButton = document.getElementById("finishDrawingButton");
                        finishDrawingButton.classList.remove("hidden");
                    }
                });
            }

            function deletePoints() {
                if (sensorVectorLayer) {
                    const source = sensorVectorLayer.getSource();
                    source.clear();
                }
            }

            function storePointsInLocalStorage(points) {
                localStorage.setItem('enfarm_sensor_coordinates', JSON.stringify(points));
            }

            function retrievePointsFromLocalStorage() {
                const pointsString = localStorage.getItem('enfarm_sensor_coordinates');
                if (pointsString) {
                    return JSON.parse(pointsString);
                } else {
                    return [];
                }
            }

            function disableAddSensor() {
                map.removeInteraction(sensorDrawInteraction);

                let addSensorBtnIcon = document.querySelector(".addSensorBtn i");
                let addSensorBtn = document.querySelector(".addSensorBtn");

                addSensorBtnIcon.textContent = "sensors";
                addSensorBtn.style.backgroundColor = "";
                addSensorBtnIcon.style.color = "";

                let floatingMessage = document.getElementById("floatingMessageArea");
                if (floatingMessage && floatingMessage.parentNode === map.getViewport()) {
                    map.getViewport().removeChild(floatingMessage);
                }

                startAddSensorActive = false;

                const finishButton = document.getElementById("finishDrawingButton");
                finishButton.classList.add("hidden");

                const sensorVectorLayers = map.getLayers().getArray();
                const hasPoints = sensorVectorLayers.some(
                    (layer) =>
                        layer instanceof ol.layer.Vector &&
                        layer.getSource().getFeatures().length > 0
                );

                if (hasPoints) {
                    try {
                        const message = { enfarm_sensor_coordinates: retrievePointsFromLocalStorage() };
                        window.ReactNativeWebView.postMessage(JSON.stringify(message));
                    } catch (error) {
                        // Handle the error (or do nothing to prevent logging)
                    }
                }

                const storedPoints = retrievePointsFromLocalStorage();
                if (storedPoints.length === 0) {
                    localStorage.removeItem('enfarm_sensor_coordinates');
                }
            }

            const addSensorBtn = document.querySelector(".addSensorBtn");
            const addSensorBtnIcon = addSensorBtn.querySelector("i");

            addSensorBtn.addEventListener("click", function () {
                if (startAddSensorActive) {
                    deletePoints();
                    disableAddSensor();
                } else {
                    startAddSensor();
                }
            });

            const finishButton = document.getElementById("finishDrawingButton");

            finishButton.addEventListener("click", function () {
                if (sensorVectorLayer) {
                    const source = sensorVectorLayer.getSource();
                    const features = source.getFeatures();

                    const enfarm_sensor_coordinates = [];

                    features.forEach(function (feature) {
                        const geometry = feature.getGeometry();
                        const coordinate = geometry.getCoordinates();
                        const transformedCoordinate = ol.proj.transform(coordinate, 'EPSG:3857', 'EPSG:4326');
                        const enfarm_sensor_lat = transformedCoordinate[1];
                        const enfarm_sensor_lon = transformedCoordinate[0];

                        enfarm_sensor_coordinates.push({ enfarm_sensor_lat, enfarm_sensor_lon });
                    });

                    console.log("enfarm_sensor_coordinates:", enfarm_sensor_coordinates);

                    storePointsInLocalStorage(enfarm_sensor_coordinates);

                    disableAddSensor();
                }
            });

            function deactivateAddSensor() {
                if (startAddSensorActive) {
                    disableAddSensor();
                }
            }

            document.getElementById("measureAreaBtn").addEventListener("click", deactivateAddSensor);
            document.getElementById("measureLengthBtn").addEventListener("click", deactivateAddSensor);
            document.getElementById("sketchFarmBtn").addEventListener("click", deactivateAddSensor);

            // Retrieve points from local storage when the page loads
            window.addEventListener('load', function () {
                // Define the layer only if it does not exist
                if (!sensorVectorLayer) {
                    const source = new ol.source.Vector();
                    sensorVectorLayer = new ol.layer.Vector({
                        source: source,
                        style: sensorPointStyle,
                    });
                    map.addLayer(sensorVectorLayer);
                }

                const storedPoints = retrievePointsFromLocalStorage();
                if (storedPoints.length > 0) {
                    storedPoints.forEach(function (point) {
                        const coordinate = ol.proj.transform([point.enfarm_sensor_lon, point.enfarm_sensor_lat], 'EPSG:4326', 'EPSG:3857');
                        const feature = new ol.Feature({
                            geometry: new ol.geom.Point(coordinate),
                        });
                        sensorVectorLayer.getSource().addFeature(feature);
                    });
                }
            });






            function clearAllDrawings() {
                // Show the dialog box
                const dialog = document.getElementById("dialog");
                dialog.classList.remove("hidden");

                // Handle the button clicks
                const deleteYesBtn = document.getElementById("deleteYes");
                const deleteNoBtn = document.getElementById("deleteNo");

                deleteYesBtn.addEventListener("click", function () {
                    // Remove stored polygon from local storage
                    localStorage.removeItem("enfarm_polygon_coordinates");

                    // Clear vector source and remove all features
                    vectorSource.clear();

                    // Remove farmVectorLayer from the map
                    if (farmVectorLayer) {
                        map.removeLayer(farmVectorLayer);
                        farmVectorLayer = null;
                    }

                    // Remove tooltip overlays from the map
                    for (const overlay of tooltipOverlays) {
                        map.removeOverlay(overlay);
                    }
                    tooltipOverlays = [];

                    // Remove stored sensor points from local storage
                    localStorage.removeItem("enfarm_sensor_coordinates");

                    // Clear sensorVectorLayer and remove all features
                    if (sensorVectorLayer) {
                        const source = sensorVectorLayer.getSource();
                        source.clear();
                    }

                    // Hide the dialog box
                    dialog.classList.add("hidden");

                    // Update the visibility of clearAllDrawingBtn
                    updateClearButtonVisibility();
                });

                deleteNoBtn.addEventListener("click", function () {
                    // Hide the dialog box
                    dialog.classList.add("hidden");
                });
            }

            function updateClearButtonVisibility() {
                const clearAllDrawingBtn = document.getElementById("clearAllDrawingBtn");
                const storedPolygons = localStorage.getItem("enfarm_polygon_coordinates");
                const storedPoints = localStorage.getItem("enfarm_sensor_coordinates");

                if (storedPolygons || storedPoints) {
                    clearAllDrawingBtn.style.display = "block";
                } else {
                    clearAllDrawingBtn.style.display = "none";
                }
            }

            // Attach the event listener to the clearAllDrawingBtn button
            const clearAllDrawingBtn = document.getElementById("clearAllDrawingBtn");
            clearAllDrawingBtn.addEventListener("click", clearAllDrawings);

            // Call the updateClearButtonVisibility function initially and whenever you add or remove polygons or points
            // For example, after adding a polygon or point:
            updateClearButtonVisibility();

            // Inside the deletePoints function:
            function deletePoints() {
                if (sensorVectorLayer) {
                    const source = sensorVectorLayer.getSource();
                    source.clear();
                    updateClearButtonVisibility(); // Update button visibility after clearing the points
                }
            }

            // Inside the clearAllDrawings function, after clearing all drawings:
            updateClearButtonVisibility(); // Update button visibility after clearing all drawings

            // Check if there are stored polygons when the page loads
            window.addEventListener("load", function () {
                const storedPolygons = localStorage.getItem("enfarm_polygon_coordinates");
                if (storedPolygons) {
                    updateClearButtonVisibility();
                }
            });


            ///// NORTH ARROW BUTTON \\\\\

            // Function to update the rotation of the north arrow based on the map's rotation
            function updateNorthArrowRotation() {
                const rotation = map.getView().getRotation();

                // Check if the rotation is not equal to 0
                if (rotation !== 0) {
                    northArrow.style.display = "block";
                } else {
                    northArrow.style.display = "none";
                }

                northArrow.style.transform = `rotate(${rotation}rad)`;
            }

            // Event listener for map view rotation change
            map.getView().on("change:rotation", updateNorthArrowRotation);

            // Initial rotation update
            updateNorthArrowRotation();

            // Function to reset map rotation to 0 degrees with smooth animation
            function resetMapRotation() {
                const view = map.getView();
                view.animate({
                    rotation: 0,
                    duration: 1000, // Animation duration in milliseconds
                    easing: ol.easing.easeOut // Easing function for smooth animation
                });

                // Hide the north arrow after reset
                northArrow.style.display = "none";
            }

            // Event listener for the north arrow click
            northArrow.addEventListener('click', resetMapRotation);





            ///// PAN TO DRAWNN POLYGON or USER LOCATION if no DRAWN POLYGON \\\\\
            function panToDrawnPolygon() {
                // Check if there is a drawn polygon
                const storedPolygonString = localStorage.getItem("enfarm_polygon_coordinates");
                if (storedPolygonString) {
                    const storedPolygon = JSON.parse(storedPolygonString);
                    const polygonPoints = storedPolygon.polygonPoints.map((point) =>
                        ol.proj.transform([point.lon, point.lat], "EPSG:4326", "EPSG:3857")
                    );
                    const polygonFeature = new ol.Feature({
                        geometry: new ol.geom.Polygon([polygonPoints]),
                    });
                    const polygonExtent = polygonFeature.getGeometry().getExtent();
                    const padding = [275, 275, 275, 275]; // Adjust the padding values as per your preference
                    map.getView().fit(polygonExtent, { padding: padding });
                } else {
                    // If no polygon is drawn, pan to the user location
                    panToUserLocation();
                }
            }


            // Call the panToDrawnPolygon function when the map opens
            map.once("postrender", panToDrawnPolygon);

            // Function to pan to the user location
            function panToUserLocation() {
                // Function to create the user location marker
                function createUserLocationMarker() {
                    const markerElement = document.createElement("div");
                    markerElement.className = "user-marker";

                    const markerOverlay = new ol.Overlay({
                        element: markerElement,
                        positioning: "center-center",
                        stopEvent: false,
                    });

                    map.addOverlay(markerOverlay);

                    return markerOverlay;
                }

                // Function to update the user location marker position
                function updateUserLocationMarker(markerOverlay, position) {
                    const { latitude, longitude } = position.coords;
                    const userLocation = ol.proj.fromLonLat([longitude, latitude]);

                    markerOverlay.setPosition(userLocation);
                }

                // Function to handle errors when geolocation is not available or permission denied
                function handleGeolocationError(error) {
                    console.error("Error getting user's location:", error);
                }

                // Check if geolocation is supported by the browser
                if ("geolocation" in navigator) {
                    const markerOverlay = createUserLocationMarker();

                    // Get the user's current location
                    navigator.geolocation.getCurrentPosition(
                        (position) => {
                            updateUserLocationMarker(markerOverlay, position);
                            map.getView().animate({ center: markerOverlay.getPosition(), zoom: 19 });
                        },
                        handleGeolocationError
                    );
                } else {
                    console.log("Geolocation is not supported by your browser.");
                }
            }




            ///// RESET BUTTON FUNCTION \\\\\
            // Get the reset button element
            const resetButton = document.getElementById("resetBtn");

            // Create a function to reset the webpage
            function resetWebpage() {
                location.reload();
            }

            // Add event listener to the reset button
            resetButton.addEventListener("click", resetWebpage);



            ///// SCALE BAR \\\\\
            var scale_line = new ol.control.ScaleLine({
                units: 'metric',
                bar: false,
                steps: 6,
                text: true,
                minWidth: 240,
                fontSize: 40,
                target: 'scale_bar',
            });
            map.addControl(scale_line);








            ///// USER LOCATION BUTTON \\\\\

            const userLocationLayer = new ol.layer.Vector({
                source: new ol.source.Vector(),
                style: new ol.style.Style({
                    image: new ol.style.Circle({
                        radius: 8,
                        fill: new ol.style.Fill({
                            color: '#1B6B93',
                        }),
                        stroke: new ol.style.Stroke({
                            color: 'white',
                            width: 3,
                        }),
                    }),
                }),
                name: 'User Location',
            });

            function getUserLocation() {
                if ("geolocation" in navigator) {
                    navigator.geolocation.getCurrentPosition(
                        (position) => {
                            const { latitude, longitude } = position.coords;
                            const userLocation = ol.proj.fromLonLat([longitude, latitude]);

                            // Remove existing user location feature if it exists
                            userLocationLayer.getSource().clear();

                            // Create a new user location feature
                            const userLocationFeature = new ol.Feature({
                                geometry: new ol.geom.Point(userLocation),
                            });

                            // Add the feature to the user location layer
                            userLocationLayer.getSource().addFeature(userLocationFeature);

                            // Add or update the user location layer on the map
                            const existingUserLocationLayer = map.getLayers().getArray().find(layer => layer.get('name') === 'User Location');
                            if (existingUserLocationLayer) {
                                map.removeLayer(existingUserLocationLayer);
                            }
                            map.addLayer(userLocationLayer);

                            map.getView().setCenter(userLocation);
                            map.getView().setZoom(19);
                        },
                        (error) => {
                            console.error("Error getting user location:", error);
                        }
                    );
                } else {
                    console.error("Geolocation is not supported by this browser.");
                }
            }



            // For Listening to react native app data
            window.addEventListener("message", message => {
                alert(message.data);
            });



        </script>
</body>

</html>
